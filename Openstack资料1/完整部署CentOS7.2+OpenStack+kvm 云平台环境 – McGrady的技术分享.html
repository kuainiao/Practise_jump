<!DOCTYPE html>
<!-- saved from url=(0036)https://www.tracymc.cn/archives/2049 -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="McGrady的技术分享 » Feed" href="https://www.tracymc.cn/feed">
<link rel="alternate" type="application/rss+xml" title="McGrady的技术分享 » 评论Feed" href="https://www.tracymc.cn/comments/feed">
<link rel="alternate" type="application/rss+xml" title="McGrady的技术分享 » 完整部署CentOS7.2+OpenStack+kvm 云平台环境评论Feed" href="https://www.tracymc.cn/archives/2049/feed">
<!-- <link rel='stylesheet' id='wp-block-library-css'  href='https://www.tracymc.cn/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='ct-cele-google-fonts-css'  href='//www.tracymc.cn/wp-content/uploads/sgf-css/font-219b63bd0cb3cbb62283ee13ffba3b4c.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='font-awesome-css'  href='https://www.tracymc.cn/wp-content/themes/cele/assets/font-awesome/css/font-awesome.min.css?ver=5.4.1' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='ct-cele-style-css'  href='https://www.tracymc.cn/wp-content/themes/cele/style.css?ver=5.4.1' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='wp-markdown-prettify-css'  href='https://www.tracymc.cn/wp-content/plugins/wp-markdown/css/prettify.css?ver=1.6.1' type='text/css' media='all' /> -->
<link rel="stylesheet" type="text/css" href="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/7r1q6.css" media="all">
<script src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/push.js.下载"></script><script src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/hm.js.下载"></script><script type="text/javascript">
/* <![CDATA[ */
var wps_statistics_object = {"rest_url":"https:\/\/www.tracymc.cn\/wp-json\/","wpnonce":"8801631f22"};
/* ]]> */
</script>
<script src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/7r1q6.js.下载" type="text/javascript"></script>
<!-- <script type='text/javascript' src='https://www.tracymc.cn/wp-content/plugins/wp-statistics/assets/js/front.min.js?ver=12.6.13'></script> -->
<!-- <script type='text/javascript' src='https://www.tracymc.cn/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script> -->
<!-- <script type='text/javascript' src='https://www.tracymc.cn/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script> -->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.tracymc.cn/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.tracymc.cn/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Docker集群管理工具-Kubernetes部署记录" href="https://www.tracymc.cn/archives/2001">
<link rel="next" title="用OZ工具制作openstack镜像" href="https://www.tracymc.cn/archives/2005">
<link rel="canonical" href="https://www.tracymc.cn/archives/2049">
<link rel="shortlink" href="https://www.tracymc.cn/?p=2049">
<!-- Analytics by WP-Statistics v12.6.13 - https://wp-statistics.com/ -->
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style><link rel="icon" href="https://www.tracymc.cn/wp-content/uploads/2018/03/timg-150x150.jpeg" sizes="32x32">
<link rel="icon" href="https://www.tracymc.cn/wp-content/uploads/2018/03/timg.jpeg" sizes="192x192">
<link rel="apple-touch-icon" href="https://www.tracymc.cn/wp-content/uploads/2018/03/timg.jpeg">
<meta name="msapplication-TileImage" content="https://www.tracymc.cn/wp-content/uploads/2018/03/timg.jpeg">
<style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>
<body id="cele" class="post-template-default single single-post postid-2049 single-format-standard">
<a class="skip-content" href="https://www.tracymc.cn/archives/2049#main">Press "Enter" to skip to content</a>
<div id="overflow-container" class="overflow-container">
<div id="max-width" class="max-width">
<div id="main-sidebar" class="main-sidebar down-page" style="top: 29902.4px;">
<div id="sidebar-inner" class="sidebar-inner">
<header class="site-header" id="site-header" role="banner">
<div id="title-container" class="title-container">
<div id="site-title" class="site-title"><a href="https://www.tracymc.cn/">McGrady的技术分享</a></div>						<p class="tagline">最淡的墨水也胜过最强的记忆.</p>					</div>
<button id="toggle-navigation" class="toggle-navigation" name="toggle-navigation" aria-expanded="false">
<span class="screen-reader-text">open menu</span>
<svg width="24px" height="18px" viewBox="0 0 24 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g transform="translate(-148.000000, -36.000000)" fill="#6B6B6B">
<g transform="translate(123.000000, 25.000000)">
<g transform="translate(25.000000, 11.000000)">
<rect x="0" y="16" width="24" height="2"></rect>
<rect x="0" y="8" width="24" height="2"></rect>
<rect x="0" y="0" width="24" height="2"></rect>
</g>
</g>
</g>
</g>
</svg>					</button>
<div id="menu-primary-container" class="menu-primary-container">
<div id="menu-primary" class="menu-container menu-primary" role="navigation">
</div>
</div>
</header>
<div id="sidebar-primary-container" class="sidebar-primary-container">
<aside class="sidebar sidebar-primary" id="sidebar-primary" role="complementary">
<h1 class="screen-reader-text">Sidebar</h1>
<section id="calendar-2" class="widget widget_calendar"><div id="calendar_wrap" class="calendar_wrap"><table id="wp-calendar" class="wp-calendar-table">
<caption>2020年五月</caption>
<thead>
<tr>
<th scope="col" title="星期一">一</th>
<th scope="col" title="星期二">二</th>
<th scope="col" title="星期三">三</th>
<th scope="col" title="星期四">四</th>
<th scope="col" title="星期五">五</th>
<th scope="col" title="星期六">六</th>
<th scope="col" title="星期日">日</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4" class="pad">&nbsp;</td><td>1</td><td>2</td><td>3</td>
</tr>
<tr>
<td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
</tr>
<tr>
<td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td id="today">16</td><td>17</td>
</tr>
<tr>
<td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td>
</tr>
<tr>
<td>25</td><td>26</td><td>27</td><td>28</td><td>29</td><td>30</td><td>31</td>
</tr>
</tbody>
</table><nav aria-label="上个月及下个月" class="wp-calendar-nav">
<span class="wp-calendar-nav-prev"><a href="https://www.tracymc.cn/archives/date/2020/04">« 4月</a></span>
<span class="pad">&nbsp;</span>
<span class="wp-calendar-nav-next">&nbsp;</span>
</nav></div></section><section id="search-3" class="widget widget_search"><div class="search-form-container">
<form role="search" method="get" class="search-form" action="https://www.tracymc.cn/">
<label class="screen-reader-text" for="search-field">Search</label>
<input id="search-field" type="search" class="search-field" value="" name="s" title="Search for:" placeholder="Search for...">
<input type="submit" class="search-submit" value="Go">
</form>
</div></section><section id="wp_statistics_widget-2" class="widget widget_wp_statistics_widget"><h2 class="widget-title">简要统计</h2><ul><li><label>过去7天的访问量: </label>1,678</li><li><label>累计访问: </label>47,536</li><li><label>累计访客: </label>32,223</li><li><label>总浏览量: </label>159</li><li><label>总计文章: </label>413</li><li><label>文章平均: </label>1</li></ul></section><section id="categories-3" class="widget widget_categories"><h2 class="widget-title">分类目录</h2>		<ul>
<li class="cat-item cat-item-16"><a href="https://www.tracymc.cn/archives/category/docker">Docker</a> (42)
</li>
<li class="cat-item cat-item-15"><a href="https://www.tracymc.cn/archives/category/wordpress">Wordpress</a> (25)
</li>
<li class="cat-item cat-item-10"><a href="https://www.tracymc.cn/archives/category/%e4%b8%ad%e9%97%b4%e4%bb%b6">中间件</a> (61)
</li>
<li class="cat-item cat-item-13"><a href="https://www.tracymc.cn/archives/category/%e4%b8%bb%e6%9c%ba">主机</a> (154)
</li>
<li class="cat-item cat-item-9"><a href="https://www.tracymc.cn/archives/category/%e5%85%b6%e5%ae%83">其它</a> (55)
</li>
<li class="cat-item cat-item-11"><a href="https://www.tracymc.cn/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93">数据库</a> (92)
</li>
<li class="cat-item cat-item-12"><a href="https://www.tracymc.cn/archives/category/%e7%9b%91%e6%8e%a7">监控</a> (47)
</li>
</ul>
</section>		<section id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widget-title">近期文章</h2>		<ul>
<li>
<a href="https://www.tracymc.cn/archives/3436">禁用WordPress Gutenberg古腾堡编辑器两个方法</a>
</li>
<li>
<a href="https://www.tracymc.cn/archives/3432">WordPress官网429 too many requests的完美解决方案</a>
</li>
<li>
<a href="https://www.tracymc.cn/archives/3430">如何运行多个memcached实例和如何使用memcached的unix socket模式</a>
</li>
<li>
<a href="https://www.tracymc.cn/archives/3425">Tomcat 日志及参数的乱码问题</a>
</li>
<li>
<a href="https://www.tracymc.cn/archives/3423">CentOS升级rsync版本</a>
</li>
</ul>
</section><section id="archives-2" class="widget widget_archive"><h2 class="widget-title">文章归档</h2>		<ul>
<li><a href="https://www.tracymc.cn/archives/date/2020/04">2020年四月</a>&nbsp;(8)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/12">2019年十二月</a>&nbsp;(18)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/10">2019年十月</a>&nbsp;(1)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/08">2019年八月</a>&nbsp;(13)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/07">2019年七月</a>&nbsp;(5)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/05">2019年五月</a>&nbsp;(13)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/04">2019年四月</a>&nbsp;(9)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/03">2019年三月</a>&nbsp;(13)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/02">2019年二月</a>&nbsp;(16)</li>
<li><a href="https://www.tracymc.cn/archives/date/2019/01">2019年一月</a>&nbsp;(20)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/12">2018年十二月</a>&nbsp;(15)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/11">2018年十一月</a>&nbsp;(25)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/10">2018年十月</a>&nbsp;(19)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/09">2018年九月</a>&nbsp;(52)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/08">2018年八月</a>&nbsp;(59)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/06">2018年六月</a>&nbsp;(28)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/05">2018年五月</a>&nbsp;(43)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/04">2018年四月</a>&nbsp;(53)</li>
<li><a href="https://www.tracymc.cn/archives/date/2018/03">2018年三月</a>&nbsp;(3)</li>
</ul>
</section><section id="recent-comments-3" class="widget widget_recent_comments"><h2 class="widget-title">近期评论</h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href="http://www.zhxjwx.com/" rel="external nofollow ugc" class="url">师兄今天想开了吗</a></span>发表在《<a href="https://www.tracymc.cn/archives/3436#comment-710">禁用WordPress Gutenberg古腾堡编辑器两个方法</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://www.tracymc.cn/" rel="external nofollow ugc" class="url">tracy</a></span>发表在《<a href="https://www.tracymc.cn/archives/3363#comment-636">kubespray2.11安装kubernetes1.15</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://www.npc.ink/" rel="external nofollow ugc" class="url">Muze</a></span>发表在《<a href="https://www.tracymc.cn/archives/3363#comment-633">kubespray2.11安装kubernetes1.15</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://www.tracymc.cn/" rel="external nofollow ugc" class="url">tracy</a></span>发表在《<a href="https://www.tracymc.cn/archives/3363#comment-588">kubespray2.11安装kubernetes1.15</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://www.chenii.com/" rel="external nofollow ugc" class="url">南生余</a></span>发表在《<a href="https://www.tracymc.cn/archives/3363#comment-587">kubespray2.11安装kubernetes1.15</a>》</li></ul></section><section id="linkcat-14" class="widget widget_links"><h2 class="widget-title">我的朋友</h2>
<ul class="xoxo blogroll">
<li><a href="http://www.itarea.cn/" target="_blank">IT大本营</a></li>
<li><a href="https://renwole.com/" target="_blank">任我乐</a></li>
<li><a href="https://www.chenii.com/" target="_blank">南生余</a></li>
<li><a href="https://www.xiaoz.me/" target="_blank">小z博客</a></li>
<li><a href="https://faq.xiaoz.me/" target="_blank">小z博客</a></li>
<li><a href="https://wzfou.com/" target="_blank">挖站否</a></li>
<li><a href="http://danilelxp.com/" target="_blank">杂谈漫话小站</a></li>
<li><a href="https://www.laobuluo.com/" target="_blank">老部落</a></li>
<li><a href="https://www.wangyanhe.com/" target="_blank">闲云野鹤</a></li>
</ul>
</section>
</aside>
</div>
</div>
</div>
<section id="main" class="main" role="main" style="min-height: 33095.4px;">
<div id="loop-container" class="loop-container">
<div class="post-2049 post type-post status-publish format-standard hentry category-13 tag-openstack entry">
<article>
<div class="post-header">
<h1 class="post-title">完整部署CentOS7.2+OpenStack+kvm 云平台环境</h1>
<div class="post-byline"><span>Published <a class="date" href="https://www.tracymc.cn/archives/date/2018/09">五月 16, 2020</a></span></div>		</div>
<div class="post-content">
<p>公司在IDC机房有两台很高配置的服务器，计划在上面部署openstack云平台虚拟化环境，用于承载后期开发测试和其他的一些对内业务。<br>
以下对openstack的部署过程及其使用做一详细介绍，仅仅依据本人实际经验而述，如有不当，敬请指出~</p>
<hr>
<h1>1 OpenStack 介绍</h1>
<h2>1.1 百度百科</h2>
<p>OpenStack 是一个由 NASA （ 美国国家航空航天局）和 Rackspace 合作研发并发起的，以 Apache<br>
许可证授权的自由软件和开放源代码项目。</p>
<h2>1.2 版本历史</h2>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363994663564.jpg" alt="">￼</p>
<h2>1.3 openstack 架构概念</h2>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363994742365.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363994832793.jpg" alt="">￼</p>
<h2>1.4 openstack 各个服务名称对应</h2>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363994902235.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363994942075.jpg" alt="">￼</p>
<hr>
<p>以下安装部署已经过测试，完全通过！</p>
<p><strong>建议在物理机上部署openstack，并且是centos7或ubuntu系统下，centos6x的源里已不支持openstack部分组件下载了。</strong></p>
<h1>2 环境准备</h1>
<p>openstack 主机名不能改，装的时候是什么就是什么， 运维标准化。</p>
<h2>1、 CentOS 7.2 系统 2 台</h2>
<p><strong>node1 即作为控制节点，也作为计算节点；(即可以单机部署，单机部署时则下面记录的控制节点和计算节点的操作步骤都要在本机执行下)<br>
node2 就只是计算节点<br>
控制节点去操控计算节点，计算节点上可以创建虚拟机</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pln">linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">openstack   </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> </span><span class="pun">网卡</span><span class="pln"> NAT em2 </span><span class="pun">（外网</span><span class="pln">ip</span><span class="pun">假设是</span><span class="lit">58.68</span><span class="pun">.</span><span class="lit">250.17</span><span class="pun">）(</span><span class="pln">em2</span><span class="pun">是内网网卡，下面</span><span class="pln">neutron</span><span class="pun">配置文件里会设置到)</span><span class="pln">
linux</span><span class="pun">-</span><span class="pln">node2</span><span class="pun">.</span><span class="pln">openstack   </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pln">   </span><span class="pun">网卡</span><span class="pln"> NAT em2</span></code></pre>
<p><strong>控制节点：linux-node1.openstack    192.168.1.17</strong><br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363995698992.jpg" alt="">￼</p>
<p>计算节点：linux-node2.openstack 192.168.1.8<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363995767456.jpg" alt="">￼</p>
<h2>2.域名解析和关闭防火墙 （控制节点和计算节点都做）</h2>
<pre class="prettyprint prettyprinted" style=""><code><span class="str">/etc/</span><span class="pln">hosts                                                         </span><span class="com">#主机名一开始设置好，后面就不能更改了，否则就会出问题！这里设置好ip与主机名的对应关系</span><span class="pln">
</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">openstack      
</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pln">   linux</span><span class="pun">-</span><span class="pln">node2</span><span class="pun">.</span><span class="pln">openstack  </span></code></pre>
<p>关闭 selinux</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pln">sed </span><span class="pun">-</span><span class="pln">i </span><span class="str">'s#SELINUX=enforcing#SELINUX=disabled#g'</span><span class="pln"> </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">sysconfig</span><span class="pun">/</span><span class="pln">selinux
setenforce </span><span class="lit">0</span><span class="pln">
</span><span class="pun">关闭</span><span class="pln"> iptables
systemctl start firewalld</span><span class="pun">.</span><span class="pln">service
systemctl stop firewalld</span><span class="pun">.</span><span class="pln">service
systemctl disable firewalld</span><span class="pun">.</span><span class="pln">service</span></code></pre>
<h2>3 安装配置 OpenStack</h2>
<p>官方文档 http://docs.openstack.org/</p>
<h3>3.1 安装软件包</h3>
<p><strong>linux-node1.openstack   安装</strong></p>
<hr>
<pre class="prettyprint prettyprinted" style=""><code><span class="com">#Base</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y http</span><span class="pun">:</span><span class="com">//dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y centos</span><span class="pun">-</span><span class="pln">release</span><span class="pun">-</span><span class="pln">openstack</span><span class="pun">-</span><span class="pln">liberty
yum install </span><span class="pun">-</span><span class="pln">y python</span><span class="pun">-</span><span class="pln">openstackclient

</span><span class="com">##MySQL</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y mariadb mariadb</span><span class="pun">-</span><span class="pln">server </span><span class="typ">MySQL</span><span class="pun">-</span><span class="pln">python

</span><span class="com">##RabbitMQ</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y rabbitmq</span><span class="pun">-</span><span class="pln">server

</span><span class="com">##Keystone</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">keystone httpd mod_wsgi memcached python</span><span class="pun">-</span><span class="pln">memcached

</span><span class="com">##Glance</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">glance python</span><span class="pun">-</span><span class="pln">glance python</span><span class="pun">-</span><span class="pln">glanceclient

</span><span class="com">##Nova</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">api openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">cert openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">conductor openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">console openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">novncproxy openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">scheduler python</span><span class="pun">-</span><span class="pln">novaclient

</span><span class="com">##Neutron linux-node1.example.com</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">neutron openstack</span><span class="pun">-</span><span class="pln">neutron</span><span class="pun">-</span><span class="pln">ml2 openstack</span><span class="pun">-</span><span class="pln">neutron</span><span class="pun">-</span><span class="pln">linuxbridge python</span><span class="pun">-</span><span class="pln">neutronclient ebtables ipset

</span><span class="com">##Dashboard</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">dashboard

</span><span class="com">##Cinder</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">cinder python</span><span class="pun">-</span><span class="pln">cinderclient
</span></code></pre>
<hr>
<p><strong>linux-node2.openstack   安装</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="com">##Base</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y http</span><span class="pun">:</span><span class="com">//dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm</span><span class="pln">
yum install centos</span><span class="pun">-</span><span class="pln">release</span><span class="pun">-</span><span class="pln">openstack</span><span class="pun">-</span><span class="pln">liberty
yum install python</span><span class="pun">-</span><span class="pln">openstackclient

</span><span class="com">##Nova linux-node2.openstack</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">compute sysfsutils

</span><span class="com">##Neutron linux-node2.openstack</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">neutron openstack</span><span class="pun">-</span><span class="pln">neutron</span><span class="pun">-</span><span class="pln">linuxbridge ebtables ipset

</span><span class="com">##Cinder</span><span class="pln">
yum install </span><span class="pun">-</span><span class="pln">y openstack</span><span class="pun">-</span><span class="pln">cinder python</span><span class="pun">-</span><span class="pln">cinderclient targetcli python</span><span class="pun">-</span><span class="pln">oslo</span><span class="pun">-</span><span class="pln">policy</span></code></pre>
<hr>
<h3>3.2 设置时间同步、 关闭 selinux 和 iptables</h3>
<p><strong>在 linux-node1 上配置（ 只有 centos7 能用， 6 还用 ntp）</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> yum install </span><span class="pun">-</span><span class="pln">y chrony
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">chrony</span><span class="pun">.</span><span class="pln">conf
allow </span><span class="lit">192.168</span><span class="pun">/</span><span class="lit">16</span><span class="pln"> </span><span class="com">#允许那些服务器和自己同步时间</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl enable chronyd</span><span class="pun">.</span><span class="pln">service    </span><span class="com">#开机启动</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl start chronyd</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> timedatectl </span><span class="kwd">set</span><span class="pun">-</span><span class="pln">timezone </span><span class="typ">Asia</span><span class="pun">/</span><span class="typ">Shanghai</span><span class="pln">     </span><span class="com">#设置时区</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> timedatectl status
</span><span class="typ">Local</span><span class="pln"> time</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Fri</span><span class="pln"> </span><span class="lit">2016</span><span class="pun">-</span><span class="lit">08</span><span class="pun">-</span><span class="lit">26</span><span class="pln"> </span><span class="lit">11</span><span class="pun">:</span><span class="lit">14</span><span class="pun">:</span><span class="lit">19</span><span class="pln"> CST
</span><span class="typ">Universal</span><span class="pln"> time</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Fri</span><span class="pln"> </span><span class="lit">2016</span><span class="pun">-</span><span class="lit">08</span><span class="pun">-</span><span class="lit">26</span><span class="pln"> </span><span class="lit">03</span><span class="pun">:</span><span class="lit">14</span><span class="pun">:</span><span class="lit">19</span><span class="pln"> UTC
RTC time</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Fri</span><span class="pln"> </span><span class="lit">2016</span><span class="pun">-</span><span class="lit">08</span><span class="pun">-</span><span class="lit">26</span><span class="pln"> </span><span class="lit">03</span><span class="pun">:</span><span class="lit">14</span><span class="pun">:</span><span class="lit">19</span><span class="pln">
</span><span class="typ">Time</span><span class="pln"> zone</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Asia</span><span class="pun">/</span><span class="typ">Shanghai</span><span class="pln"> </span><span class="pun">(</span><span class="pln">CST</span><span class="pun">,</span><span class="pln"> </span><span class="pun">+</span><span class="lit">0800</span><span class="pun">)</span><span class="pln">
NTP enabled</span><span class="pun">:</span><span class="pln"> yes
NTP </span><span class="kwd">synchronized</span><span class="pun">:</span><span class="pln"> yes
RTC </span><span class="kwd">in</span><span class="pln"> </span><span class="kwd">local</span><span class="pln"> TZ</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">no</span><span class="pln">
DST active</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">/</span><span class="pln">a</span></code></pre>
<p><strong>在 linux-node2 上配置</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> yum install </span><span class="pun">-</span><span class="pln">y chrony
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">chrony</span><span class="pun">.</span><span class="pln">conf
server </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> iburst </span><span class="com">#只留一行</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl enable chronyd</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl start chronyd</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> timedatectl </span><span class="kwd">set</span><span class="pun">-</span><span class="pln">timezone </span><span class="typ">Asia</span><span class="pun">/</span><span class="typ">Shanghai</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> chronyc sources</span></code></pre>
<h3>3.3 安装及配置 mysql</h3>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cp </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">share</span><span class="pun">/</span><span class="pln">mysql</span><span class="pun">/</span><span class="kwd">my</span><span class="pun">-</span><span class="pln">medium</span><span class="pun">.</span><span class="pln">cnf </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="kwd">my</span><span class="pun">.</span><span class="pln">cnf                   </span><span class="com">#或者是/usr/share/mariadb/my-medium.cnf</span><span class="pln">
</span><span class="pun">[</span><span class="pln">mysqld</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">default</span><span class="pun">-</span><span class="pln">storage</span><span class="pun">-</span><span class="pln">engine </span><span class="pun">=</span><span class="pln"> innodb
innodb_file_per_table
collation</span><span class="pun">-</span><span class="pln">server </span><span class="pun">=</span><span class="pln"> utf8_general_ci
init</span><span class="pun">-</span><span class="pln">connect </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET NAMES utf8'</span><span class="pln">
character</span><span class="pun">-</span><span class="kwd">set</span><span class="pun">-</span><span class="pln">server </span><span class="pun">=</span><span class="pln"> utf8
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl enable mariadb</span><span class="pun">.</span><span class="pln">service                                                      </span><span class="com">#Centos7里面mysql叫maridb</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ln </span><span class="pun">-</span><span class="pln">s </span><span class="str">'/usr/lib/systemd/system/mariadb.service'</span><span class="pln"> </span><span class="str">'/etc/systemd/system/multi-user.target.wants/mariadb.service'</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> mysql_install_db </span><span class="pun">--</span><span class="pln">datadir</span><span class="pun">=</span><span class="str">"/var/lib/mysql"</span><span class="pln"> </span><span class="pun">--</span><span class="pln">user</span><span class="pun">=</span><span class="str">"mysql"</span><span class="pln">               </span><span class="com">#初始化数据库</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl start mariadb</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> mysql_secure_installation                                                                 </span><span class="com">#设置密码及初始化</span><span class="pln">
</span><span class="pun">密码</span><span class="pln"> </span><span class="lit">123456</span><span class="pun">，一路</span><span class="pln"> y </span><span class="pun">回车</span></code></pre>
<p><strong>创建数据库</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> mysql </span><span class="pun">-</span><span class="pln">p123456
</span><span class="typ">Welcome</span><span class="pln"> to the </span><span class="typ">MariaDB</span><span class="pln"> monitor</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Commands</span><span class="pln"> </span><span class="kwd">end</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> </span><span class="pun">;</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> \g</span><span class="pun">.</span><span class="pln">
</span><span class="typ">Your</span><span class="pln"> </span><span class="typ">MariaDB</span><span class="pln"> connection id </span><span class="kwd">is</span><span class="pln"> </span><span class="lit">5579</span><span class="pln">
</span><span class="typ">Server</span><span class="pln"> version</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5.5</span><span class="pun">.</span><span class="lit">50</span><span class="pun">-</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="typ">MariaDB</span><span class="pln"> </span><span class="typ">Server</span><span class="pln">

</span><span class="typ">Copyright</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="lit">2000</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2016</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Oracle</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MariaDB</span><span class="pln"> </span><span class="typ">Corporation</span><span class="pln"> </span><span class="typ">Ab</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> others</span><span class="pun">.</span><span class="pln">

</span><span class="typ">Type</span><span class="pln"> </span><span class="str">'help;'</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="str">'\h'</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> help</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="str">'\c'</span><span class="pln"> to clear the current input statement</span><span class="pun">.</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> CREATE DATABASE keystone</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON keystone</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'keystone'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'keystone'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON keystone</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'keystone'</span><span class="pun">@</span><span class="str">'%'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'keystone'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> CREATE DATABASE glance</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON glance</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'glance'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'glance'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON glance</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'glance'</span><span class="pun">@</span><span class="str">'%'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'glance'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> CREATE DATABASE nova</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON nova</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'nova'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'nova'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON nova</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'nova'</span><span class="pun">@</span><span class="str">'%'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'nova'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> CREATE DATABASE neutron</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON neutron</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'neutron'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'neutron'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON neutron</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'neutron'</span><span class="pun">@</span><span class="str">'%'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'neutron'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> CREATE DATABASE cinder</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON cinder</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'cinder'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'cinder'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> GRANT ALL PRIVILEGES ON cinder</span><span class="pun">.*</span><span class="pln"> TO </span><span class="str">'cinder'</span><span class="pun">@</span><span class="str">'%'</span><span class="pln"> IDENTIFIED BY </span><span class="str">'cinder'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> flush privileges</span><span class="pun">;</span><span class="pln">
</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span><span class="pln"> show databases</span><span class="pun">;</span><span class="pln">
</span><span class="pun">+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Database</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> information_schema   </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> cinder                       </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> glance                       </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> keystone                    </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> mysql                        </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> neutron                     </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> nova                         </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> performance_schema </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------+</span><span class="pln">
</span><span class="lit">8</span><span class="pln"> rows </span><span class="kwd">in</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.00</span><span class="pln"> sec</span><span class="pun">)</span><span class="pln">

</span><span class="typ">MariaDB</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">none</span><span class="pun">)]&gt;</span></code></pre>
<h3>3.4 配置 rabbitmq</h3>
<p>MQ 全称为 Message Queue, 消息队列（ MQ）是一种应用程序对应用程序的通信方法。应用<br>
程序通过读写出入队列的消息（针对应用程序的数据）来通信，而无需专用连接来链接它们。<br>
消 息传递指的是程序之间通过在消息中发送数据进行通信，而不是通过直接调用彼此来通<br>
信，直接调用通常是用于诸如远程过程调用的技术。排队指的是应用程序通过 队列来通信。<br>
队列的使用除去了接收和发送应用程序同时执行的要求。<br>
RabbitMQ 是一个在 AMQP 基础上完整的，可复用的企业消息系统。他遵循 Mozilla Public<br>
License 开源协议。<br>
启动 rabbitmq， 端口 5672，添加 openstack 用户</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl enable rabbitmq</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ln </span><span class="pun">-</span><span class="pln">s </span><span class="str">'/usr/lib/systemd/system/rabbitmq-server.service'</span><span class="pln"> </span><span class="str">'/etc/systemd/system/multi-user.target.wants/rabbitmq-server.service'</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl start rabbitmq</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> rabbitmqctl add_user openstack openstack                               </span><span class="com">#添加用户及密码</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> rabbitmqctl set_permissions openstack </span><span class="str">".*"</span><span class="pln"> </span><span class="str">".*"</span><span class="pln"> </span><span class="str">".*"</span><span class="pln">                                   </span><span class="com">#允许配置、写、读访问 openstack</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> rabbitmq</span><span class="pun">-</span><span class="pln">plugins list                                 </span><span class="com">#查看支持的插件</span><span class="pln">
</span><span class="pun">.........</span><span class="pln">
</span><span class="pun">[</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> rabbitmq_management </span><span class="lit">3.6</span><span class="pun">.</span><span class="lit">2</span><span class="pln">                                    </span><span class="com">#使用此插件实现 web 管理</span><span class="pln">
</span><span class="pun">.........</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> rabbitmq</span><span class="pun">-</span><span class="pln">plugins enable rabbitmq_management </span><span class="com">#启动插件</span><span class="pln">
</span><span class="typ">The</span><span class="pln"> following plugins have been enabled</span><span class="pun">:</span><span class="pln">
mochiweb
webmachine
rabbitmq_web_dispatch
amqp_client
rabbitmq_management_agent
rabbitmq_management
</span><span class="typ">Plugin</span><span class="pln"> configuration has changed</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Restart</span><span class="pln"> </span><span class="typ">RabbitMQ</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> changes to take effect</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl restart rabbitmq</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">service

</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">lsof </span><span class="pun">-</span><span class="pln">i</span><span class="pun">:</span><span class="lit">15672</span><span class="pln">
</span></code></pre>
<p>访问RabbitMQ,访问地址是http://58.68.250.17:15672<br>
默认用户名密码都是guest，浏览器添加openstack用户到组并登陆测试，连不上情况一般是防火墙没有关闭所致！<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363998328835.jpg" alt="">￼</p>
<p>之后退出使用 openstack 登录<br>
如何使用 zabbix 监控？<br>
左下角有 HTTP API 的介绍，可以实现 zabbix 的监控<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363998450273.jpg" alt="">￼</p>
<hr>
<p><strong>以上完成基础环境的配置，下面开始安装 openstack 的组件</strong></p>
<h3>3.5 配置 Keystone 验证服务</h3>
<p>所有的服务，都需要在 keystone 上注册</p>
<h4>3.5.1 Keystone 介绍</h4>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363998745469.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363998777536.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15363998830940.jpg" alt="">￼</p>
<h4>3.5.2 配置 Keystone</h4>
<p>端口 5000 和 35357</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">.</span><span class="pln">conf
</span><span class="pun">取一个随机数</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openssl rand </span><span class="pun">-</span><span class="pln">hex </span><span class="lit">10</span><span class="pln">
</span><span class="lit">35d6e6f377a889571bcf</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
admin_token </span><span class="pun">=</span><span class="pln"> </span><span class="lit">35d6e6f377a889571bcf</span><span class="pln">                                    </span><span class="com">#设置 token，和上面产生的随机数值一致</span><span class="pln">
verbose </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">[</span><span class="pln">assignment</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">auth</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cache</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">catalog</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cors</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cors</span><span class="pun">.</span><span class="pln">subdomain</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">credential</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">database</span><span class="pun">]</span><span class="pln">
connection </span><span class="pun">=</span><span class="pln"> mysql</span><span class="pun">:</span><span class="com">//keystone:keystone@192.168.1.17/keystone                                          #设置数据库连接 写到database下</span><span class="pln">
</span><span class="pun">[</span><span class="pln">domain_config</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">endpoint_filter</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">endpoint_policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">eventlet_server</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">eventlet_server_ssl</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">federation</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">fernet_tokens</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">identity</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">identity_mapping</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">kvs</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ldap</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_redis</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_ring</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">memcache</span><span class="pun">]</span><span class="pln">
servers </span><span class="pun">=</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pun">:</span><span class="lit">11211</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oauth1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">os_inherit</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_amqp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_qpid</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_rabbit</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_middleware</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">paste_deploy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">resource</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">revoke</span><span class="pun">]</span><span class="pln">
driver </span><span class="pun">=</span><span class="pln"> sql
</span><span class="pun">[</span><span class="pln">role</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">saml</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">signing</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ssl</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">token</span><span class="pun">]</span><span class="pln">
provider </span><span class="pun">=</span><span class="pln"> uuid
driver </span><span class="pun">=</span><span class="pln"> memcache
</span><span class="pun">[</span><span class="pln">tokenless_auth</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">trust</span><span class="pun">]</span><span class="pln">
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">2</span><span class="pun">、</span><span class="pln"> </span><span class="pun">创建数据库表，</span><span class="pln"> </span><span class="pun">使用命令同步</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> su </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">sh </span><span class="pun">-</span><span class="pln">c </span><span class="str">"keystone-manage db_sync"</span><span class="pln"> keystone
</span><span class="typ">No</span><span class="pln"> handlers could be found </span><span class="kwd">for</span><span class="pln"> logger </span><span class="str">"oslo_config.cfg"</span><span class="pln">                                          </span><span class="com">#出现这个信息，不影响后续操作！忽略~</span><span class="pln">

</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ll </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">.</span><span class="pln">log
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln">r</span><span class="pun">--.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> keystone keystone </span><span class="lit">298370</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">26</span><span class="pln"> </span><span class="lit">11</span><span class="pun">:</span><span class="lit">36</span><span class="pln"> </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">.</span><span class="pln">log      </span><span class="com">#之所以上面 su 切换是因为这个日志文件属主</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 config</span><span class="pun">]#</span><span class="pln"> mysql </span><span class="pun">-</span><span class="pln">h </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> </span><span class="pun">-</span><span class="pln">u keystone </span><span class="pun">-</span><span class="pln">p      </span><span class="com">#数据库检查表,生产环境密码不要用keystone，改成复杂点的密码</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">3</span><span class="pun">、</span><span class="pln"> </span><span class="pun">启动</span><span class="pln"> memcached </span><span class="pun">和</span><span class="pln"> apache
</span><span class="pun">启动</span><span class="pln"> memcached
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl enable memcached
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">ln </span><span class="pun">-</span><span class="pln">s </span><span class="str">'/usr/lib/systemd/system/memcached.service'</span><span class="pln"> </span><span class="str">'/etc/systemd/system/multi-user.target.wants/memcached.service'</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl start memcached
</span><span class="pun">配置</span><span class="pln"> httpd
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">conf</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">.</span><span class="pln">conf
</span><span class="typ">ServerName</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pun">:</span><span class="lit">80</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">conf</span><span class="pun">.</span><span class="pln">d</span><span class="pun">/</span><span class="pln">wsgi</span><span class="pun">-</span><span class="pln">keystone</span><span class="pun">.</span><span class="pln">conf
</span><span class="typ">Listen</span><span class="pln"> </span><span class="lit">5000</span><span class="pln">
</span><span class="typ">Listen</span><span class="pln"> </span><span class="lit">35357</span><span class="pln">

</span><span class="pun">&lt;</span><span class="typ">VirtualHost</span><span class="pln"> </span><span class="pun">*:</span><span class="lit">5000</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">WSGIDaemonProcess</span><span class="pln"> keystone</span><span class="pun">-</span><span class="kwd">public</span><span class="pln"> processes</span><span class="pun">=</span><span class="lit">5</span><span class="pln"> threads</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> user</span><span class="pun">=</span><span class="pln">keystone </span><span class="kwd">group</span><span class="pun">=</span><span class="pln">keystone display</span><span class="pun">-</span><span class="pln">name</span><span class="pun">=%{</span><span class="pln">GROUP</span><span class="pun">}</span><span class="pln">
</span><span class="typ">WSGIProcessGroup</span><span class="pln"> keystone</span><span class="pun">-</span><span class="kwd">public</span><span class="pln">
</span><span class="typ">WSGIScriptAlias</span><span class="pln"> </span><span class="str">/ /</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">wsgi</span><span class="pun">-</span><span class="kwd">public</span><span class="pln">
</span><span class="typ">WSGIApplicationGroup</span><span class="pln"> </span><span class="pun">%{</span><span class="pln">GLOBAL</span><span class="pun">}</span><span class="pln">
</span><span class="typ">WSGIPassAuthorization</span><span class="pln"> </span><span class="typ">On</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">ErrorLogFormat</span><span class="pln"> </span><span class="str">"%{cu}t %M"</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">ErrorLog</span><span class="pln"> </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">error</span><span class="pun">.</span><span class="pln">log
</span><span class="typ">CustomLog</span><span class="pln"> </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">access</span><span class="pun">.</span><span class="pln">log combined
</span><span class="pun">&lt;</span><span class="typ">Directory</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">Require</span><span class="pln"> all granted
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">Order</span><span class="pln"> allow</span><span class="pun">,</span><span class="pln">deny
</span><span class="typ">Allow</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> all
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">Directory</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">VirtualHost</span><span class="pun">&gt;</span><span class="pln">

</span><span class="pun">&lt;</span><span class="typ">VirtualHost</span><span class="pln"> </span><span class="pun">*:</span><span class="lit">35357</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">WSGIDaemonProcess</span><span class="pln"> keystone</span><span class="pun">-</span><span class="pln">admin processes</span><span class="pun">=</span><span class="lit">5</span><span class="pln"> threads</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> user</span><span class="pun">=</span><span class="pln">keystone </span><span class="kwd">group</span><span class="pun">=</span><span class="pln">keystone display</span><span class="pun">-</span><span class="pln">name</span><span class="pun">=%{</span><span class="pln">GROUP</span><span class="pun">}</span><span class="pln">
</span><span class="typ">WSGIProcessGroup</span><span class="pln"> keystone</span><span class="pun">-</span><span class="pln">admin
</span><span class="typ">WSGIScriptAlias</span><span class="pln"> </span><span class="str">/ /</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">wsgi</span><span class="pun">-</span><span class="pln">admin
</span><span class="typ">WSGIApplicationGroup</span><span class="pln"> </span><span class="pun">%{</span><span class="pln">GLOBAL</span><span class="pun">}</span><span class="pln">
</span><span class="typ">WSGIPassAuthorization</span><span class="pln"> </span><span class="typ">On</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">ErrorLogFormat</span><span class="pln"> </span><span class="str">"%{cu}t %M"</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">ErrorLog</span><span class="pln"> </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">error</span><span class="pun">.</span><span class="pln">log
</span><span class="typ">CustomLog</span><span class="pln"> </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">keystone</span><span class="pun">-</span><span class="pln">access</span><span class="pun">.</span><span class="pln">log combined
</span><span class="pun">&lt;</span><span class="typ">Directory</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">Require</span><span class="pln"> all granted
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;</span><span class="typ">IfVersion</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2.4</span><span class="pun">&gt;</span><span class="pln">
</span><span class="typ">Order</span><span class="pln"> allow</span><span class="pun">,</span><span class="pln">deny
</span><span class="typ">Allow</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> all
</span><span class="pun">&lt;/</span><span class="typ">IfVersion</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">Directory</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">VirtualHost</span><span class="pun">&gt;</span><span class="pln">

</span><span class="pun">启动</span><span class="pln"> httpd
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 config</span><span class="pun">]#</span><span class="pln"> systemctl enable httpd
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 config</span><span class="pun">]#</span><span class="pln">ln </span><span class="pun">-</span><span class="pln">s </span><span class="str">'/usr/lib/systemd/system/httpd.service'</span><span class="pln"> </span><span class="str">'/etc/systemd/system/multi-user.target.wants/httpd.service'</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 config</span><span class="pun">]#</span><span class="pln"> systemctl start httpd
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> netstat </span><span class="pun">-</span><span class="pln">lntup</span><span class="pun">|</span><span class="pln">grep httpd
tcp6 </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:::</span><span class="lit">5000</span><span class="pln"> </span><span class="pun">:::*</span><span class="pln"> LISTEN </span><span class="lit">23632</span><span class="pun">/</span><span class="pln">httpd
tcp6 </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:::</span><span class="lit">80</span><span class="pln"> </span><span class="pun">:::*</span><span class="pln"> LISTEN </span><span class="lit">23632</span><span class="pun">/</span><span class="pln">httpd
tcp6 </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:::</span><span class="lit">35357</span><span class="pln"> </span><span class="pun">:::*</span><span class="pln"> LISTEN </span><span class="lit">23632</span><span class="pun">/</span><span class="pln">httpd
</span><span class="pun">如果</span><span class="pln"> http </span><span class="pun">起不来关闭</span><span class="pln"> selinux </span><span class="pun">或者安装</span><span class="pln"> yum install openstack</span><span class="pun">-</span><span class="pln">selinux
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">4</span><span class="pun">、</span><span class="pln"> </span><span class="pun">创建</span><span class="pln"> keystone </span><span class="pun">用户</span><span class="pln">
</span><span class="pun">临时设置</span><span class="pln"> admin_token </span><span class="pun">用户的环境变量，用来创建用户</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> </span><span class="kwd">export</span><span class="pln"> OS_TOKEN</span><span class="pun">=</span><span class="lit">35d6e6f377a889571bcf</span><span class="pln">                           </span><span class="com">#上面产生的随机数值</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> </span><span class="kwd">export</span><span class="pln"> OS_URL</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v3</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> </span><span class="kwd">export</span><span class="pln"> OS_IDENTITY_API_VERSION</span><span class="pun">=</span><span class="lit">3</span><span class="pln">

</span><span class="pun">创建</span><span class="pln"> admin </span><span class="pun">项目---创建</span><span class="pln"> admin </span><span class="pun">用户（密码</span><span class="pln"> admin</span><span class="pun">，生产不要这么玩）</span><span class="pln"> </span><span class="pun">---创建</span><span class="pln"> admin </span><span class="pun">角色---把</span><span class="pln"> admin </span><span class="pun">用户加入到</span><span class="pln"> admin </span><span class="pun">项目赋予</span><span class="pln"> admin </span><span class="pun">的角色（三个</span><span class="pln"> admin </span><span class="pun">的位置：项目，用户，角色）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack project create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">description </span><span class="str">"Admin Project"</span><span class="pln"> admin
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack user create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">password</span><span class="pun">-</span><span class="pln">prompt admin
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack role create admin
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack role add </span><span class="pun">--</span><span class="pln">project admin </span><span class="pun">--</span><span class="pln">user admin admin
</span><span class="pun">创建一个普通用户</span><span class="pln"> demo
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack project create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">description </span><span class="str">"Demo Project"</span><span class="pln"> demo
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack user create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">password</span><span class="pun">=</span><span class="pln">demo demo
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack role create user
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack role add </span><span class="pun">--</span><span class="pln">project demo </span><span class="pun">--</span><span class="pln">user demo user

</span><span class="pun">创建</span><span class="pln"> service </span><span class="pun">项目，用来管理其他服务用</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack project create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">description </span><span class="str">"Service Project"</span><span class="pln"> service

</span><span class="pun">以上的名字都是固定的，不能改</span><span class="pln">

</span><span class="pun">查看创建的而用户和项目</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack user list
</span><span class="pun">+----------------------------------+-------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+-------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b1f164577a2d43b9a6393527f38e3f75 </span><span class="pun">|</span><span class="pln"> demo </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b694d8f0b70b41d883665f9524c77766 </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+-------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack project list
</span><span class="pun">+----------------------------------+---------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+---------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">604f9f78853847ac9ea3c31f2c7f677d</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> demo </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">777f4f0108b1476eabc11e00dccaea9f</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> aa087f62f1d44676834d43d0d902d473 </span><span class="pun">|</span><span class="pln"> service </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+---------+</span><span class="pln">
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">5</span><span class="pun">、注册</span><span class="pln"> keystone </span><span class="pun">服务，以下三种类型分别为公共的、内部的、管理的。</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack service create </span><span class="pun">--</span><span class="pln">name keystone </span><span class="pun">--</span><span class="pln">description </span><span class="str">"OpenStack Identity"</span><span class="pln"> identity
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> identity </span><span class="kwd">public</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> identity </span><span class="kwd">internal</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> identity admin http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v2.0</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint list </span><span class="com">#查看</span><span class="pln">
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+----</span><span class="pln">
</span><span class="pun">-------+---------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Region</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Enabled</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="typ">Interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> URL </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+----</span><span class="pln">
</span><span class="pun">-------+---------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">011a24def8664506985815e0ed2f8fa5</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b0981cae6a8c4b3186edef818733fec6 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> c4e0c79c0a8142eda4d9653064563991 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin
</span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v2.0 |</span><span class="pln">
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+----</span><span class="pln">
</span><span class="pun">-------+---------------------------------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint </span><span class="kwd">delete</span><span class="pln"> ID                                    </span><span class="com">#使用这个命令删除</span><span class="pln">
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">6</span><span class="pun">、</span><span class="pln"> </span><span class="pun">验证，获取</span><span class="pln"> token</span><span class="pun">，只有获取到才能说明</span><span class="pln"> keystone </span><span class="pun">配置成功</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> unset OS_TOKEN
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> unset OS_URL
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack </span><span class="pun">--</span><span class="pln">os</span><span class="pun">-</span><span class="pln">auth</span><span class="pun">-</span><span class="pln">url http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v3 --os-project-domain-id default --os-user-domain-id default --os-project-name admin --os-username admin --os-auth-type password token issue                   #回车</span><span class="pln">
</span><span class="typ">Password</span><span class="pun">:</span><span class="pln"> admin
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Field</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> expires </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2015</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">17T04</span><span class="pun">:</span><span class="lit">22</span><span class="pun">:</span><span class="lit">00.600668Z</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1b530a078b874438aadb77af11ce297e</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> project_id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">777f4f0108b1476eabc11e00dccaea9f</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> user_id </span><span class="pun">|</span><span class="pln"> b694d8f0b70b41d883665f9524c77766 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">

</span><span class="pun">使用环境变量来获取</span><span class="pln"> token</span><span class="pun">，环境变量在后面创建虚拟机时也需要用。</span><span class="pln">
</span><span class="pun">创建两个环境变量文件，使用时直接</span><span class="pln"> source</span><span class="pun">！！！（注意，下面两个</span><span class="pln">sh</span><span class="pun">文件所在的路径，在查看命令前都要</span><span class="pln">source</span><span class="pun">下，不然会报错！！）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="kwd">export</span><span class="pln"> OS_PROJECT_DOMAIN_ID</span><span class="pun">=</span><span class="kwd">default</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_USER_DOMAIN_ID</span><span class="pun">=</span><span class="kwd">default</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_PROJECT_NAME</span><span class="pun">=</span><span class="pln">admin
</span><span class="kwd">export</span><span class="pln"> OS_TENANT_NAME</span><span class="pun">=</span><span class="pln">admin
</span><span class="kwd">export</span><span class="pln"> OS_USERNAME</span><span class="pun">=</span><span class="pln">admin
</span><span class="kwd">export</span><span class="pln"> OS_PASSWORD</span><span class="pun">=</span><span class="pln">admin
</span><span class="kwd">export</span><span class="pln"> OS_AUTH_URL</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v3</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_IDENTITY_API_VERSION</span><span class="pun">=</span><span class="lit">3</span><span class="pln">

</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat demo</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="kwd">export</span><span class="pln"> OS_PROJECT_DOMAIN_ID</span><span class="pun">=</span><span class="kwd">default</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_USER_DOMAIN_ID</span><span class="pun">=</span><span class="kwd">default</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_PROJECT_NAME</span><span class="pun">=</span><span class="pln">demo
</span><span class="kwd">export</span><span class="pln"> OS_TENANT_NAME</span><span class="pun">=</span><span class="pln">demo
</span><span class="kwd">export</span><span class="pln"> OS_USERNAME</span><span class="pun">=</span><span class="pln">demo
</span><span class="kwd">export</span><span class="pln"> OS_PASSWORD</span><span class="pun">=</span><span class="pln">demo
</span><span class="kwd">export</span><span class="pln"> OS_AUTH_URL</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v3</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> OS_IDENTITY_API_VERSION</span><span class="pun">=</span><span class="lit">3</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack token issue
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Field</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> expires </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2015</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">17T04</span><span class="pun">:</span><span class="lit">26</span><span class="pun">:</span><span class="lit">08.625399Z</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">58370ae3b9bb4c07a67700dd184ad3b1</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="lit">16</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> project_id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">777f4f0108b1476eabc11e00dccaea9f</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> user_id </span><span class="pun">|</span><span class="pln"> b694d8f0b70b41d883665f9524c77766 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+------------+----------------------------------+</span><span class="pln">
</span></code></pre>
<h3>3.6 配置 glance 镜像服务</h3>
<h4>3.6.1 glance 介绍</h4>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364000547165.jpg" alt="">￼</p>
<h4>3.6.2 glance 配置</h4>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">端口：</span><span class="pln">
api            </span><span class="lit">9191</span><span class="pln">
registry    </span><span class="lit">9292</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">api</span><span class="pun">.</span><span class="pln">conf </span><span class="pun">和/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">registry</span><span class="pun">.</span><span class="pln">conf
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">api</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
verbose</span><span class="pun">=</span><span class="kwd">True</span><span class="pln">
notification_driver </span><span class="pun">=</span><span class="pln"> noop                                           </span><span class="com">#galnce 不需要消息队列</span><span class="pln">
</span><span class="pun">[</span><span class="pln">database</span><span class="pun">]</span><span class="pln">
connection</span><span class="pun">=</span><span class="pln">mysql</span><span class="pun">:</span><span class="com">//glance:glance@192.168.1.17/glance</span><span class="pln">
</span><span class="pun">[</span><span class="pln">glance_store</span><span class="pun">]</span><span class="pln">
default_store</span><span class="pun">=</span><span class="pln">file
filesystem_store_datadir</span><span class="pun">=</span><span class="str">/var/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">
</span><span class="pun">[</span><span class="pln">image_format</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">keystone_authtoken</span><span class="pun">]</span><span class="pln">
auth_uri </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> glance
password </span><span class="pun">=</span><span class="pln"> glance
</span><span class="pun">[</span><span class="pln">matchmaker_redis</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_ring</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_concurrency</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_amqp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_qpid</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_rabbit</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">paste_deploy</span><span class="pun">]</span><span class="pln">
flavor</span><span class="pun">=</span><span class="pln">keystone
</span><span class="pun">[</span><span class="pln">store_type_location_strategy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">task</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">taskflow_executor</span><span class="pun">]</span><span class="pln">

</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">registry</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
verbose</span><span class="pun">=</span><span class="kwd">True</span><span class="pln">
notification_driver </span><span class="pun">=</span><span class="pln"> noop
</span><span class="pun">[</span><span class="pln">database</span><span class="pun">]</span><span class="pln">
connection</span><span class="pun">=</span><span class="pln">mysql</span><span class="pun">:</span><span class="com">//glance:glance@192.168.1.17/glance</span><span class="pln">
</span><span class="pun">[</span><span class="pln">glance_store</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">keystone_authtoken</span><span class="pun">]</span><span class="pln">
auth_uri </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> glance
password </span><span class="pun">=</span><span class="pln"> glance
</span><span class="pun">[</span><span class="pln">matchmaker_redis</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_ring</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_amqp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_qpid</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_rabbit</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">paste_deploy</span><span class="pun">]</span><span class="pln">
flavor</span><span class="pun">=</span><span class="pln">keystone
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">2</span><span class="pun">、创建数据库表，同步数据库</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> su </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">sh </span><span class="pun">-</span><span class="pln">c </span><span class="str">"glance-manage db_sync"</span><span class="pln"> glance
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> mysql </span><span class="pun">-</span><span class="pln">h </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> </span><span class="pun">-</span><span class="pln">uglance </span><span class="pun">-</span><span class="pln">p
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">3</span><span class="pun">、</span><span class="pln"> </span><span class="pun">创建关于</span><span class="pln"> glance </span><span class="pun">的</span><span class="pln"> keystone </span><span class="pun">用户</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack user create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">password</span><span class="pun">=</span><span class="pln">glance glance
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack role add </span><span class="pun">--</span><span class="pln">project service </span><span class="pun">--</span><span class="pln">user glance admin</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">4</span><span class="pun">、启动</span><span class="pln"> glance
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl enable openstack</span><span class="pun">-</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">api
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl enable openstack</span><span class="pun">-</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">registry
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl start openstack</span><span class="pun">-</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">api
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl start openstack</span><span class="pun">-</span><span class="pln">glance</span><span class="pun">-</span><span class="pln">registry
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> netstat </span><span class="pun">-</span><span class="pln">lnutp </span><span class="pun">|</span><span class="pln">grep </span><span class="lit">9191</span><span class="pln"> </span><span class="com">#registry</span><span class="pln">
tcp </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">:</span><span class="lit">9191</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">:*</span><span class="pln"> LISTEN
</span><span class="lit">24890</span><span class="pun">/</span><span class="pln">python2
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> netstat </span><span class="pun">-</span><span class="pln">lnutp </span><span class="pun">|</span><span class="pln">grep </span><span class="lit">9292</span><span class="pln"> </span><span class="com">#api</span><span class="pln">
tcp </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">:</span><span class="lit">9292</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">:*</span><span class="pln"> LISTEN
</span><span class="lit">24877</span><span class="pun">/</span><span class="pln">python2
</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">5</span><span class="pun">、在</span><span class="pln"> keystone </span><span class="pun">上注册</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack service create </span><span class="pun">--</span><span class="pln">name glance </span><span class="pun">--</span><span class="pln">description </span><span class="str">"OpenStack Image service"</span><span class="pln"> image
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> image </span><span class="kwd">public</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> image </span><span class="kwd">internal</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> image admin http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">6</span><span class="pun">、添加</span><span class="pln"> glance </span><span class="pun">环境变量并测试</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 src</span><span class="pun">]#</span><span class="pln"> echo </span><span class="str">"export OS_IMAGE_API_VERSION=2"</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> tee </span><span class="pun">-</span><span class="pln">a admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh demo</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 src</span><span class="pun">]#</span><span class="pln"> glance image</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+----+------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----+------+</span><span class="pln">
</span><span class="pun">+----+------+</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">7</span><span class="pun">、</span><span class="pln"> </span><span class="pun">下载镜像并上传到</span><span class="pln"> glance </span><span class="pun">【此处下载的</span><span class="pln">qcow2</span><span class="pun">格式镜像比较小，可以直接下载</span><span class="pln">ios</span><span class="pun">格式镜像，然后用</span><span class="pln">oz</span><span class="pun">工具制造】</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> wget </span><span class="pun">-</span><span class="pln">q http</span><span class="pun">:</span><span class="com">//download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img                                   #也可以提前下载下来</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> glance image</span><span class="pun">-</span><span class="pln">create </span><span class="pun">--</span><span class="pln">name </span><span class="str">"cirros"</span><span class="pln"> </span><span class="pun">--</span><span class="pln">file cirros</span><span class="pun">-</span><span class="lit">0.3</span><span class="pun">.</span><span class="lit">4</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="pln">disk</span><span class="pun">.</span><span class="pln">img </span><span class="pun">--</span><span class="pln">disk</span><span class="pun">-</span><span class="pln">format qcow2 </span><span class="pun">--</span><span class="pln">container</span><span class="pun">-</span><span class="pln">format bare </span><span class="pun">--</span><span class="pln">visibility </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">--</span><span class="pln">progress
</span><span class="pun">[=============================&gt;]</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%</span><span class="pln">
</span><span class="pun">+------------------+--------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Property</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+------------------+--------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> checksum </span><span class="pun">|</span><span class="pln"> ee1eca47dc88f4879d8a229cc70a07c6 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> container_format </span><span class="pun">|</span><span class="pln"> bare </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> created_at </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2015</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">17T04</span><span class="pun">:</span><span class="lit">11</span><span class="pun">:</span><span class="lit">02Z</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> disk_format </span><span class="pun">|</span><span class="pln"> qcow2 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2707a30b</span><span class="pun">-</span><span class="lit">853f</span><span class="pun">-</span><span class="lit">4d04</span><span class="pun">-</span><span class="lit">861d</span><span class="pun">-</span><span class="pln">e05b0f1855c8 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> min_disk </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> min_ram </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> name </span><span class="pun">|</span><span class="pln"> cirros </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> owner </span><span class="pun">|</span><span class="pln"> </span><span class="lit">777f4f0108b1476eabc11e00dccaea9f</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">protected</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">False</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> size </span><span class="pun">|</span><span class="pln"> </span><span class="lit">13287936</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> status </span><span class="pun">|</span><span class="pln"> active </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> tags </span><span class="pun">|</span><span class="pln"> </span><span class="pun">[]</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> updated_at </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2015</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">17T04</span><span class="pun">:</span><span class="lit">11</span><span class="pun">:</span><span class="lit">03Z</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> virtual_size </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">None</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> visibility </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span></code></pre>
<h2>+------------------+--------------------------------------+</h2>
<p>下载ios格式镜像，需要用OZ工具制造openstack镜像，具体操作请见另一篇博客：</p>
<p>实际生产环境下，肯定要使用ios镜像进行制作了</p>
<blockquote class="wp-embedded-content" data-secret="BkrIQnsNuM" style="display: none;"><p><a href="https://www.tracymc.cn/archives/2005">用OZ工具制作openstack镜像</a></p></blockquote>
<p><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/embed.html" data-secret="BkrIQnsNuM" width="500" height="200" title="《用OZ工具制作openstack镜像》—Tracymc的技术博客" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<hr>
<p>或者直接下载centos的qcow2格式镜像进行上传，qcow2格式镜像直接就可以在openstack里使用，不需要进行格式转换！<br>
下载地址：http://cloud.centos.org/centos，可以到里面下载centos5/6/7的qcow2格式的镜像</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">wget http</span><span class="pun">:</span><span class="com">//cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">glance image</span><span class="pun">-</span><span class="pln">create </span><span class="pun">--</span><span class="pln">name </span><span class="str">"CentOS-7-x86_64"</span><span class="pln"> </span><span class="pun">--</span><span class="pln">file </span><span class="typ">CentOS</span><span class="pun">-</span><span class="lit">7</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="typ">GenericCloud</span><span class="pun">.</span><span class="pln">qcow2 </span><span class="pun">--</span><span class="pln">disk</span><span class="pun">-</span><span class="pln">format qcow2 </span><span class="pun">--</span><span class="pln">container</span><span class="pun">-</span><span class="pln">format bare </span><span class="pun">--</span><span class="pln">visibility </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">--</span><span class="pln">progress</span></code></pre>
<hr>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> glance image</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2707a30b</span><span class="pun">-</span><span class="lit">853f</span><span class="pun">-</span><span class="lit">4d04</span><span class="pun">-</span><span class="lit">861d</span><span class="pun">-</span><span class="pln">e05b0f1855c8 </span><span class="pun">|</span><span class="pln"> cirros </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+</span><span class="pln">

</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ll </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">glance</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">
</span><span class="pun">总用量</span><span class="pln"> </span><span class="lit">12980</span><span class="pln">
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">-----.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> glance glance </span><span class="lit">1569390592</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">26</span><span class="pln"> </span><span class="lit">12</span><span class="pun">:</span><span class="lit">50</span><span class="pln"> </span><span class="lit">35b36f08</span><span class="pun">-</span><span class="pln">eeb9</span><span class="pun">-</span><span class="lit">4a91</span><span class="pun">-</span><span class="lit">9366</span><span class="pun">-</span><span class="lit">561f0a308a1b</span></code></pre>
<h3>3.7 配置 nova 计算服务</h3>
<h4>3.7.1 nova 介绍</h4>
<p>nova 必备的组件<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364009676280.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364009720988.jpg" alt="">￼<br>
<strong>nova scheduler</strong><br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364009749168.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364009779289.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364009807631.jpg" alt="">￼</p>
<h4>3.7.2 Nova 控制节点配置</h4>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
my_ip</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln">
enabled_apis</span><span class="pun">=</span><span class="pln">osapi_compute</span><span class="pun">,</span><span class="pln">metadata
auth_strategy</span><span class="pun">=</span><span class="pln">keystone
network_api_class</span><span class="pun">=</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">network</span><span class="pun">.</span><span class="pln">neutronv2</span><span class="pun">.</span><span class="pln">api</span><span class="pun">.</span><span class="pln">API
linuxnet_interface_driver</span><span class="pun">=</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">network</span><span class="pun">.</span><span class="pln">linux_net</span><span class="pun">.</span><span class="typ">NeutronLinuxBridgeInterfaceDriver</span><span class="pln">
security_group_api</span><span class="pun">=</span><span class="pln">neutron
firewall_driver </span><span class="pun">=</span><span class="pln"> nova</span><span class="pun">.</span><span class="pln">virt</span><span class="pun">.</span><span class="pln">firewall</span><span class="pun">.</span><span class="typ">NoopFirewallDriver</span><span class="pln">
debug</span><span class="pun">=</span><span class="kwd">true</span><span class="pln">
verbose</span><span class="pun">=</span><span class="kwd">true</span><span class="pln">
rpc_backend</span><span class="pun">=</span><span class="pln">rabbit
allow_resize_to_same_host</span><span class="pun">=</span><span class="kwd">True</span><span class="pln">
scheduler_default_filters</span><span class="pun">=</span><span class="typ">RetryFilter</span><span class="pun">,</span><span class="typ">AvailabilityZoneFilter</span><span class="pun">,</span><span class="typ">RamFilter</span><span class="pun">,</span><span class="typ">ComputeFilter</span><span class="pun">,</span><span class="typ">ComputeCapabilitiesFilter</span><span class="pun">,</span><span class="typ">ImagePropertiesFilter</span><span class="pun">,</span><span class="typ">ServerGroupAntiAffinityFilter</span><span class="pun">,</span><span class="typ">ServerGroupAffinityFilter</span><span class="pln">
</span><span class="pun">[</span><span class="pln">api_database</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">barbican</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cells</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cinder</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">conductor</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cors</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">cors</span><span class="pun">.</span><span class="pln">subdomain</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">database</span><span class="pun">]</span><span class="pln">
connection</span><span class="pun">=</span><span class="pln">mysql</span><span class="pun">:</span><span class="com">//nova:nova@192.168.1.17/nova</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ephemeral_storage_encryption</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">glance</span><span class="pun">]</span><span class="pln">
host</span><span class="pun">=</span><span class="pln">$my_ip
</span><span class="pun">[</span><span class="pln">guestfs</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">hyperv</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">image_file_url</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ironic</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">keymgr</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">keystone_authtoken</span><span class="pun">]</span><span class="pln">
auth_uri </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> nova
password </span><span class="pun">=</span><span class="pln"> nova
</span><span class="pun">[</span><span class="pln">libvirt</span><span class="pun">]</span><span class="pln">
virt_type</span><span class="pun">=</span><span class="pln">kvm                                  </span><span class="com">#如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_redis</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_ring</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">metrics</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">neutron</span><span class="pun">]</span><span class="pln">
url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
region_name </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> neutron
password </span><span class="pun">=</span><span class="pln"> neutron
service_metadata_proxy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
metadata_proxy_shared_secret </span><span class="pun">=</span><span class="pln"> neutron
lock_path</span><span class="pun">=</span><span class="str">/var/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">tmp
</span><span class="pun">[</span><span class="pln">osapi_v21</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_concurrency</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_amqp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_qpid</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_rabbit</span><span class="pun">]</span><span class="pln">
rabbit_host</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln">
rabbit_port</span><span class="pun">=</span><span class="lit">5672</span><span class="pln">
rabbit_userid</span><span class="pun">=</span><span class="pln">openstack
rabbit_password</span><span class="pun">=</span><span class="pln">openstack
</span><span class="pun">[</span><span class="pln">oslo_middleware</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">rdp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">serial_console</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">spice</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ssl</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">trusted_computing</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">upgrade_levels</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">vmware</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">vnc</span><span class="pun">]</span><span class="pln">
novncproxy_base_url</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//58.68.250.17:6080/vnc_auto.html      #如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的），配置控制节点的公网ip</span><span class="pln">
vncserver_listen</span><span class="pun">=</span><span class="pln"> $my_ip
vncserver_proxyclient_address</span><span class="pun">=</span><span class="pln"> $my_ip
keymap</span><span class="pun">=</span><span class="pln">en</span><span class="pun">-</span><span class="pln">us           </span><span class="com">#如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">workarounds</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">xenserver</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">zookeeper</span><span class="pun">]</span><span class="pln">
</span></code></pre>
<p>{网络部分为啥这么写：<code>network_api_class=nova.network.neutronv2.api.API}</code></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ls </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">python2</span><span class="pun">.</span><span class="lit">7</span><span class="pun">/</span><span class="pln">site</span><span class="pun">-</span><span class="pln">packages</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">network</span><span class="pun">/</span><span class="pln">neutronv2</span><span class="pun">/</span><span class="pln">api</span><span class="pun">.</span><span class="pln">py
</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">python2</span><span class="pun">.</span><span class="lit">7</span><span class="pun">/</span><span class="pln">site</span><span class="pun">-</span><span class="pln">packages</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">network</span><span class="pun">/</span><span class="pln">neutronv2</span><span class="pun">/</span><span class="pln">api</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>这里面有一个 API 方法，其他配置类似</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">2</span><span class="pun">、同步数据库</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> su </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">sh </span><span class="pun">-</span><span class="pln">c </span><span class="str">"nova-manage db sync"</span><span class="pln"> nova
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> mysql </span><span class="pun">-</span><span class="pln">h </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln"> </span><span class="pun">-</span><span class="pln">unova </span><span class="pun">-</span><span class="pln">p </span><span class="pun">检查</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">3</span><span class="pun">、创建</span><span class="pln"> nova </span><span class="pun">的</span><span class="pln"> keystone </span><span class="pun">用户</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack user create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">password</span><span class="pun">=</span><span class="pln">nova nova
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack role add </span><span class="pun">--</span><span class="pln">project service </span><span class="pun">--</span><span class="pln">user nova admin</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">4</span><span class="pun">、启动</span><span class="pln"> nova </span><span class="pun">相关服务</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl enable openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">api</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">cert</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">consoleauth</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">scheduler</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">conductor</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">novncproxy</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln">systemctl start openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">api</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">cert</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">consoleauth</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">scheduler</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">conductor</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">novncproxy</span><span class="pun">.</span><span class="pln">service</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">5</span><span class="pun">、在</span><span class="pln"> keystone </span><span class="pun">上注册</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack service create </span><span class="pun">--</span><span class="pln">name nova </span><span class="pun">--</span><span class="pln">description </span><span class="str">"OpenStack Compute"</span><span class="pln"> compute
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> compute </span><span class="kwd">public</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%\(tenant_id\)s</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> compute </span><span class="kwd">internal</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%\(tenant_id\)s</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> compute admin http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%\(tenant_id\)s</span><span class="pln">
</span><span class="pun">检查</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack host list
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Host</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Zone</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> conductor </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> scheduler </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> consoleauth </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> cert </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span></code></pre>
<h4>3.7.3   nova 计算节点配置</h4>
<p>1、 nova compute 介绍<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364011778803.jpg" alt="">￼</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">2</span><span class="pun">、修改配置文件/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf
</span><span class="pun">可以直接从</span><span class="pln"> node1 </span><span class="pun">拷贝到</span><span class="pln"> node2 </span><span class="pun">上</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> scp </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pun">:</span><span class="str">/etc/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">
</span><span class="pun">手动更改如下配置</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf
my_ip</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pln">
novncproxy_base_url</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//192.168.1.17:6080/vnc_auto.html</span><span class="pln">
vncserver_listen</span><span class="pun">=</span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pln">
vncserver_proxyclient_address</span><span class="pun">=</span><span class="pln"> $my_ip
keymap</span><span class="pun">=</span><span class="pln">en</span><span class="pun">-</span><span class="pln">us
</span><span class="pun">[</span><span class="pln">glance</span><span class="pun">]</span><span class="pln">
host</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">56.17</span><span class="pln">
</span><span class="pun">[</span><span class="pln">libvirt</span><span class="pun">]</span><span class="pln">
virt_type</span><span class="pun">=</span><span class="pln">kvm                   </span><span class="com">#虚拟机类型，默认是 kvm</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">3</span><span class="pun">、启动服务</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl enable libvirtd openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">compute
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl start libvirtd openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">compute</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">4</span><span class="pun">、在控制节点测试（计算节点上也行，需要环境变量）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack host list
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Host</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Zone</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> conductor </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> consoleauth </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> scheduler </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node1</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> cert </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> linux</span><span class="pun">-</span><span class="pln">node2</span><span class="pun">.</span><span class="pln">oldboyedu</span><span class="pun">.</span><span class="pln">com </span><span class="pun">|</span><span class="pln"> compute </span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+---------------------------+-------------+----------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova image</span><span class="pun">-</span><span class="pln">list                  </span><span class="com">#测试 glance 是否正常</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Status</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Server</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2707a30b</span><span class="pun">-</span><span class="lit">853f</span><span class="pun">-</span><span class="lit">4d04</span><span class="pun">-</span><span class="lit">861d</span><span class="pun">-</span><span class="pln">e05b0f1855c8 </span><span class="pun">|</span><span class="pln"> cirros </span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova endpoints                     </span><span class="com">#测试 keystone</span><span class="pln">
WARNING</span><span class="pun">:</span><span class="pln"> keystone has </span><span class="kwd">no</span><span class="pln"> endpoint </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> </span><span class="typ">Available</span><span class="pln"> endpoints </span><span class="kwd">for</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> service</span><span class="pun">:</span><span class="pln">           </span><span class="com">#这一行告警不影响后面的操作</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">02fed35802734518922d0ca2d672f469</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">52b0a1a700f04773a220ff0e365dea45</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">88df7df6427d45619df192979219e65c</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v2.0 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
WARNING</span><span class="pun">:</span><span class="pln"> nova has </span><span class="kwd">no</span><span class="pln"> endpoint </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> </span><span class="typ">Available</span><span class="pln"> endpoints </span><span class="kwd">for</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> service</span><span class="pun">:</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1a3115941ff54b7499a800c7c43ee92a</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/65a0c00638c247a0a274837aa6eb165f |</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">5278f33a42754c9a8d90937932b8c0b3</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/65a0c00638c247a0a274837aa6eb165f |</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">8c4fa7b9a24949c5882949d13d161d36</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/65a0c00638c247a0a274837aa6eb165f |</span><span class="pln">
</span><span class="pun">+-----------+--------------------------------------------------------------+</span><span class="pln">
WARNING</span><span class="pun">:</span><span class="pln"> glance has </span><span class="kwd">no</span><span class="pln"> endpoint </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> </span><span class="typ">Available</span><span class="pln"> endpoints </span><span class="kwd">for</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> service</span><span class="pun">:</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> </span><span class="lit">31fbf72537a14ba7927fe9c7b7d06a65</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> be788b4aa2ce4251b424a3182d0eea11 </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Value</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> d0052712051a4f04bb59c06e2d5b2a0b </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> region_id </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> url </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">+-----------+----------------------------------+</span></code></pre>
<h3>3.8 Neutron 网络服务</h3>
<h4>3.8.1 Neutron 介绍</h4>
<p><strong>neutron 由来</strong><br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364012578061.jpg" alt="">￼</p>
<p><strong>openstack 网络分类：</strong><br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364012665442.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364012806954.jpg" alt="">￼</p>
<p><strong>Neutron 组件</strong><br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364012910178.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364012947303.jpg" alt="">￼</p>
<h4>3.8.2 Neutron 控制节点配置（ 5 个配置文件）</h4>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">.</span><span class="pln">conf </span><span class="pun">文件</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
state_path </span><span class="pun">=</span><span class="pln"> </span><span class="str">/var/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">neutron
core_plugin </span><span class="pun">=</span><span class="pln"> ml2
service_plugins </span><span class="pun">=</span><span class="pln"> router
auth_strategy </span><span class="pun">=</span><span class="pln"> keystone
notify_nova_on_port_status_changes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
notify_nova_on_port_data_changes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
nova_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2</span><span class="pln">
rpc_backend</span><span class="pun">=</span><span class="pln">rabbit
</span><span class="pun">[</span><span class="pln">matchmaker_redis</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">matchmaker_ring</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">quotas</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">agent</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">keystone_authtoken</span><span class="pun">]</span><span class="pln">
auth_uri </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> neutron
password </span><span class="pun">=</span><span class="pln"> neutron
admin_tenant_name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_TENANT_NAME</span><span class="pun">%</span><span class="pln">
admin_user </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_USER</span><span class="pun">%</span><span class="pln">
admin_password </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_PASSWORD</span><span class="pun">%</span><span class="pln">
</span><span class="pun">[</span><span class="pln">database</span><span class="pun">]</span><span class="pln">
connection </span><span class="pun">=</span><span class="pln"> mysql</span><span class="pun">:</span><span class="com">//neutron:neutron@192.168.1.17:3306/neutron</span><span class="pln">
</span><span class="pun">[</span><span class="pln">nova</span><span class="pun">]</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
region_name </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> nova
password </span><span class="pun">=</span><span class="pln"> nova
</span><span class="pun">[</span><span class="pln">oslo_concurrency</span><span class="pun">]</span><span class="pln">
lock_path </span><span class="pun">=</span><span class="pln"> $state_path</span><span class="pun">/</span><span class="kwd">lock</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_policy</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_amqp</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_qpid</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">oslo_messaging_rabbit</span><span class="pun">]</span><span class="pln">
rabbit_host </span><span class="pun">=</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln">
rabbit_port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5672</span><span class="pln">
rabbit_userid </span><span class="pun">=</span><span class="pln"> openstack
rabbit_password </span><span class="pun">=</span><span class="pln"> openstack
</span><span class="pun">[</span><span class="pln">qos</span><span class="pun">]</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">2</span><span class="pun">、</span><span class="pln"> </span><span class="pun">配置/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">ml2_conf</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">ml2_conf</span><span class="pun">.</span><span class="pln">ini</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ml2</span><span class="pun">]</span><span class="pln">
type_drivers </span><span class="pun">=</span><span class="pln"> flat</span><span class="pun">,</span><span class="pln">vlan</span><span class="pun">,</span><span class="pln">gre</span><span class="pun">,</span><span class="pln">vxlan</span><span class="pun">,</span><span class="pln">geneve
tenant_network_types </span><span class="pun">=</span><span class="pln"> vlan</span><span class="pun">,</span><span class="pln">gre</span><span class="pun">,</span><span class="pln">vxlan</span><span class="pun">,</span><span class="pln">geneve
mechanism_drivers </span><span class="pun">=</span><span class="pln"> openvswitch</span><span class="pun">,</span><span class="pln">linuxbridge
extension_drivers </span><span class="pun">=</span><span class="pln"> port_security
</span><span class="pun">[</span><span class="pln">ml2_type_flat</span><span class="pun">]</span><span class="pln">
flat_networks </span><span class="pun">=</span><span class="pln"> physnet1
</span><span class="pun">[</span><span class="pln">ml2_type_vlan</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ml2_type_gre</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ml2_type_vxlan</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">ml2_type_geneve</span><span class="pun">]</span><span class="pln">
</span><span class="pun">[</span><span class="pln">securitygroup</span><span class="pun">]</span><span class="pln">
enable_ipset </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">3</span><span class="pun">、配置/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln"> linuxbridge_agent</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">linuxbridge_agent</span><span class="pun">.</span><span class="pln">ini</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">linux_bridge</span><span class="pun">]</span><span class="pln">
physical_interface_mappings </span><span class="pun">=</span><span class="pln"> physnet1</span><span class="pun">:</span><span class="pln">em2
</span><span class="pun">[</span><span class="pln">vxlan</span><span class="pun">]</span><span class="pln">
enable_vxlan </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">[</span><span class="pln">agent</span><span class="pun">]</span><span class="pln">
prevent_arp_spoofing </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
</span><span class="pun">[</span><span class="pln">securitygroup</span><span class="pun">]</span><span class="pln">
firewall_driver </span><span class="pun">=</span><span class="pln"> neutron</span><span class="pun">.</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">linux</span><span class="pun">.</span><span class="pln">iptables_firewall</span><span class="pun">.</span><span class="typ">IptablesFirewallDriver</span><span class="pln">
enable_security_group </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">4</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">dhcp_agent</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">dhcp_agent</span><span class="pun">.</span><span class="pln">ini</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
interface_driver </span><span class="pun">=</span><span class="pln"> neutron</span><span class="pun">.</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">linux</span><span class="pun">.</span><span class="kwd">interface</span><span class="pun">.</span><span class="typ">BridgeInterfaceDriver</span><span class="pln">
dhcp_driver </span><span class="pun">=</span><span class="pln"> neutron</span><span class="pun">.</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">linux</span><span class="pun">.</span><span class="pln">dhcp</span><span class="pun">.</span><span class="typ">Dnsmasq</span><span class="pln">
enable_isolated_metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">[</span><span class="pln">AGENT</span><span class="pun">]</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">5</span><span class="pun">、修改/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">metadata_agent</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">metadata_agent</span><span class="pun">.</span><span class="pln">ini</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^#"</span><span class="pun">|</span><span class="pln">grep </span><span class="pun">-</span><span class="pln">v </span><span class="str">"^$"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">DEFAULT</span><span class="pun">]</span><span class="pln">
auth_uri </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000</span><span class="pln">
auth_url </span><span class="pun">=</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357</span><span class="pln">
auth_region </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln">
auth_plugin </span><span class="pun">=</span><span class="pln"> password
project_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
user_domain_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">default</span><span class="pln">
project_name </span><span class="pun">=</span><span class="pln"> service
username </span><span class="pun">=</span><span class="pln"> neutron
password </span><span class="pun">=</span><span class="pln"> neutron
nova_metadata_ip </span><span class="pun">=</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pln">
metadata_proxy_shared_secret </span><span class="pun">=</span><span class="pln"> neutron
admin_tenant_name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_TENANT_NAME</span><span class="pun">%</span><span class="pln">
admin_user </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_USER</span><span class="pun">%</span><span class="pln">
admin_password </span><span class="pun">=</span><span class="pln"> </span><span class="pun">%</span><span class="pln">SERVICE_PASSWORD</span><span class="pun">%</span><span class="pln">
</span><span class="pun">[</span><span class="pln">AGENT</span><span class="pun">]</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">6</span><span class="pun">、创建连接并创建</span><span class="pln"> keystone </span><span class="pun">的用户</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ln </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">ml2_conf</span><span class="pun">.</span><span class="pln">ini </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugin</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack user create </span><span class="pun">--</span><span class="pln">domain </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">password</span><span class="pun">=</span><span class="pln">neutron neutron
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack role add </span><span class="pun">--</span><span class="pln">project service </span><span class="pun">--</span><span class="pln">user neutron admin</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">7</span><span class="pun">、更新数据库</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> su </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">sh </span><span class="pun">-</span><span class="pln">c </span><span class="str">"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head"</span><span class="pln"> neutron</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">8</span><span class="pun">、注册</span><span class="pln"> keystone
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack service create </span><span class="pun">--</span><span class="pln">name neutron </span><span class="pun">--</span><span class="pln">description </span><span class="str">"OpenStack Networking"</span><span class="pln"> network
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> network </span><span class="kwd">public</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> network </span><span class="kwd">internal</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> openstack endpoint create </span><span class="pun">--</span><span class="pln">region </span><span class="typ">RegionOne</span><span class="pln"> network admin http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696</span></code></pre>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">9</span><span class="pun">、</span><span class="pln"> </span><span class="pun">启动服务并检查</span><span class="pln">
</span><span class="pun">因为</span><span class="pln">neutron</span><span class="pun">和</span><span class="pln">nova</span><span class="pun">有联系，做</span><span class="pln">neutron</span><span class="pun">时修改</span><span class="pln">nova</span><span class="pun">的配置文件，上面</span><span class="pln">nova</span><span class="pun">.</span><span class="pln">conf</span><span class="pun">已经做了</span><span class="pln">neutron</span><span class="pun">的关联配置，所以要重启</span><span class="pln">openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">api</span><span class="pun">服务。</span><span class="pln">
</span><span class="pun">这里将</span><span class="pln">nova</span><span class="pun">的关联服务都一并重启了：</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl restart openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">api</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">cert</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">consoleauth</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">scheduler</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">conductor</span><span class="pun">.</span><span class="pln">service openstack</span><span class="pun">-</span><span class="pln">nova</span><span class="pun">-</span><span class="pln">novncproxy</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">启动</span><span class="pln">neutron</span><span class="pun">相关服务</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl enable neutron</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">dhcp</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">metadata</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl start neutron</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">dhcp</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service neutron</span><span class="pun">-</span><span class="pln">metadata</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">检查</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron agent</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> agent_type </span><span class="pun">|</span><span class="pln"> host </span><span class="pun">|</span><span class="pln"> alive </span><span class="pun">|</span><span class="pln"> admin_state_up </span><span class="pun">|</span><span class="pln"> binary </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">385cebf9</span><span class="pun">-</span><span class="lit">9b34</span><span class="pun">-</span><span class="lit">4eca</span><span class="pun">-</span><span class="pln">b780</span><span class="pun">-</span><span class="pln">c515dbc7eec0 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Linux</span><span class="pln"> bridge agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b3ff8ffe</span><span class="pun">-</span><span class="lit">1ff2</span><span class="pun">-</span><span class="lit">4659</span><span class="pun">-</span><span class="pln">b823</span><span class="pun">-</span><span class="lit">331def4e6a93</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> DHCP agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">dhcp</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b5bed625</span><span class="pun">-</span><span class="lit">47fd</span><span class="pun">-</span><span class="lit">4e79</span><span class="pun">-</span><span class="pln">aa55</span><span class="pun">-</span><span class="lit">01cf8a8cc577</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Metadata</span><span class="pln"> agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">metadata</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span><span class="pln">
</span><span class="pun">查看注册信息</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server src</span><span class="pun">]#</span><span class="pln"> openstack endpoint list
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+-----------+-------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Region</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Enabled</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Interface</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> URL </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+-----------+-------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">02fed35802734518922d0ca2d672f469</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">1a3115941ff54b7499a800c7c43ee92a</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> compute </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%(tenant_id)s |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">31fbf72537a14ba7927fe9c7b7d06a65</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> image </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">5278f33a42754c9a8d90937932b8c0b3</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> compute </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%(tenant_id)s |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">52b0a1a700f04773a220ff0e365dea45</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:5000/v2.0 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">88df7df6427d45619df192979219e65c</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> keystone </span><span class="pun">|</span><span class="pln"> identity </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:35357/v2.0 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">8c4fa7b9a24949c5882949d13d161d36</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> nova </span><span class="pun">|</span><span class="pln"> compute </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:8774/v2/%(tenant_id)s |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> be788b4aa2ce4251b424a3182d0eea11 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> image </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> c059a07fa3e141a0a0b7fc2f46ca922c </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron </span><span class="pun">|</span><span class="pln"> network </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> d0052712051a4f04bb59c06e2d5b2a0b </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> glance </span><span class="pun">|</span><span class="pln"> image </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9292 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ea325a8a2e6e4165997b2e24a8948469 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron </span><span class="pun">|</span><span class="pln"> network </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">internal</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696 |</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ffdec11ccf024240931e8ca548876ef0 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">RegionOne</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron </span><span class="pun">|</span><span class="pln"> network </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> admin </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//192.168.1.17:9696 |</span><span class="pln">
</span><span class="pun">+----------------------------------+-----------+--------------+--------------+---------+-----------+-------------------------------------------+</span></code></pre>
<h4>3.8.3 Neutron 计算节点配置</h4>
<p><strong>1、修改相关配置文件</strong><br>
从 node1 上直接拷贝</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> scp </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">.</span><span class="pln">conf </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pun">:</span><span class="str">/etc/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> scp </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">linuxbridge_agent</span><span class="pun">.</span><span class="pln">ini </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pun">:</span><span class="str">/etc/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> scp </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">ml2_conf</span><span class="pun">.</span><span class="pln">ini </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.8</span><span class="pun">:</span><span class="str">/etc/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span></code></pre>
<p>修改计算节点的 nova 配置文件中 neutron 部分， 并重启 openstack-nova-compute 服务， 因为<br>
上面 nova 计算节点也是从控制节点拷贝的，此处无需操作</p>
<p><strong>2、 创建软连接并启动服务</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> ln </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugins</span><span class="pun">/</span><span class="pln">ml2</span><span class="pun">/</span><span class="pln">ml2_conf</span><span class="pun">.</span><span class="pln">ini </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">neutron</span><span class="pun">/</span><span class="pln">plugin</span><span class="pun">.</span><span class="pln">ini
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl enable neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node2 </span><span class="pun">~]#</span><span class="pln"> systemctl start neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent</span><span class="pun">.</span><span class="pln">service</span></code></pre>
<p>检查</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron agent</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> agent_type </span><span class="pun">|</span><span class="pln"> host </span><span class="pun">|</span><span class="pln"> alive </span><span class="pun">|</span><span class="pln"> admin_state_up </span><span class="pun">|</span><span class="pln"> binary </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">385cebf9</span><span class="pun">-</span><span class="lit">9b34</span><span class="pun">-</span><span class="lit">4eca</span><span class="pun">-</span><span class="pln">b780</span><span class="pun">-</span><span class="pln">c515dbc7eec0 </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Linux</span><span class="pln"> bridge agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">linuxbridge</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b3ff8ffe</span><span class="pun">-</span><span class="lit">1ff2</span><span class="pun">-</span><span class="lit">4659</span><span class="pun">-</span><span class="pln">b823</span><span class="pun">-</span><span class="lit">331def4e6a93</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> DHCP agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">dhcp</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> b5bed625</span><span class="pun">-</span><span class="lit">47fd</span><span class="pun">-</span><span class="lit">4e79</span><span class="pun">-</span><span class="pln">aa55</span><span class="pun">-</span><span class="lit">01cf8a8cc577</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Metadata</span><span class="pln"> agent </span><span class="pun">|</span><span class="pln"> openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">|</span><span class="pln"> </span><span class="pun">:-)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> neutron</span><span class="pun">-</span><span class="pln">metadata</span><span class="pun">-</span><span class="pln">agent </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------------------+------------------+-------+----------------+---------------------------+</span></code></pre>
<h3>3.9 创建虚拟机</h3>
<h4>3.9.1 创建桥接网络</h4>
<p><strong>1、 创建网络</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh                     </span><span class="com">#在哪个项目下创建虚拟机，这里选择在demo下创建；也可以在admin下</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron net</span><span class="pun">-</span><span class="pln">create flat </span><span class="pun">--</span><span class="pln">shared </span><span class="pun">--</span><span class="pln">provider</span><span class="pun">:</span><span class="pln">physical_network physnet1 </span><span class="pun">--</span><span class="pln">provider</span><span class="pun">:</span><span class="pln">network_type flat</span></code></pre>
<p><strong>2、 创建子网（填写宿主机的内网网关，下面DNS和内网网关可以设置成宿主机的内网ip，下面192.168.1.100-200是分配给虚拟机的ip范围）</strong><br>
**<br>
[root@linux-node1 ~]# neutron subnet-create flat 192.168.1.0/24 --name flat-subnet --allocation-pool start=192.168.1.100,end=192.168.1.200 --dns-nameserver 192.168.1.1 --gateway 192.168.1.1**</p>
<p><strong>3、 查看子网</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron net</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> name </span><span class="pun">|</span><span class="pln"> subnets </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">1d9657f6</span><span class="pun">-</span><span class="pln">de9e</span><span class="pun">-</span><span class="lit">488f</span><span class="pun">-</span><span class="lit">911f</span><span class="pun">-</span><span class="lit">020c8622fe78</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat </span><span class="pun">|</span><span class="pln"> c53da14a</span><span class="pun">-</span><span class="lit">01fe</span><span class="pun">-</span><span class="lit">4f6c</span><span class="pun">-</span><span class="lit">8485</span><span class="pun">-</span><span class="lit">232489deaa6e</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.0</span><span class="pun">/</span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron subnet</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+-------------+----------------+----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> name </span><span class="pun">|</span><span class="pln"> cidr </span><span class="pun">|</span><span class="pln"> allocation_pools </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+-------------+----------------+----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> c53da14a</span><span class="pun">-</span><span class="lit">01fe</span><span class="pun">-</span><span class="lit">4f6c</span><span class="pun">-</span><span class="lit">8485</span><span class="pun">-</span><span class="lit">232489deaa6e</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat</span><span class="pun">-</span><span class="pln">subnet </span><span class="pun">|</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.0</span><span class="pun">/</span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">{</span><span class="str">"start"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"192.168.1.100"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"end"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"192.168.1.200"</span><span class="pun">}</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+-------------+----------------+----------------------------------------------------+</span></code></pre>
<p>需要关闭 VMware 的 dhcp</p>
<h4>3.9.2 创建虚拟机（为vm分配内网ip，后续利用squid代理或宿主机NAT端口转发进行对外或对内访问）</h4>
<p><strong>1、创建 key</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> source demo</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh               </span><span class="pun">（这是在</span><span class="pln">demo</span><span class="pun">账号下创建虚拟机；要是在</span><span class="pln">admin</span><span class="pun">账号下创建虚拟机，就用</span><span class="pln">source admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh</span><span class="pun">）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ssh</span><span class="pun">-</span><span class="pln">keygen </span><span class="pun">-</span><span class="pln">q </span><span class="pun">-</span><span class="pln">N </span><span class="str">""</span></code></pre>
<p><strong>2、将公钥添加到虚拟机</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova keypair</span><span class="pun">-</span><span class="pln">add </span><span class="pun">--</span><span class="pln">pub</span><span class="pun">-</span><span class="pln">key </span><span class="pun">/</span><span class="pln">root</span><span class="pun">/.</span><span class="pln">ssh</span><span class="pun">/</span><span class="pln">id_rsa</span><span class="pun">.</span><span class="pln">pub mykey
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova keypair</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+-------+-------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Fingerprint</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-------+-------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> mykey </span><span class="pun">|</span><span class="pln"> cd</span><span class="pun">:</span><span class="lit">7a</span><span class="pun">:</span><span class="lit">1e</span><span class="pun">:</span><span class="pln">cd</span><span class="pun">:</span><span class="pln">c0</span><span class="pun">:</span><span class="lit">43</span><span class="pun">:</span><span class="lit">9b</span><span class="pun">:</span><span class="pln">b1</span><span class="pun">:</span><span class="pln">f4</span><span class="pun">:</span><span class="lit">3b</span><span class="pun">:</span><span class="pln">cf</span><span class="pun">:</span><span class="pln">cd</span><span class="pun">:</span><span class="lit">5e</span><span class="pun">:</span><span class="lit">95</span><span class="pun">:</span><span class="pln">f8</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+-------+-------------------------------------------------+</span></code></pre>
<p><strong>3、创建安全组</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova secgroup</span><span class="pun">-</span><span class="pln">add</span><span class="pun">-</span><span class="pln">rule </span><span class="kwd">default</span><span class="pln"> icmp </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">/</span><span class="lit">0</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova secgroup</span><span class="pun">-</span><span class="pln">add</span><span class="pun">-</span><span class="pln">rule </span><span class="kwd">default</span><span class="pln"> tcp </span><span class="lit">22</span><span class="pln"> </span><span class="lit">22</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">/</span><span class="lit">0</span></code></pre>
<p><strong>4、 创建虚拟机</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">查看支持的虚拟机类型</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova flavor</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Memory_MB</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Ephemeral</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Swap</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">VCPUs</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> RXTX_Factor </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Is_Public</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> m1</span><span class="pun">.</span><span class="pln">tiny </span><span class="pun">|</span><span class="pln"> </span><span class="lit">512</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> m1</span><span class="pun">.</span><span class="pln">small </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2048</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> m1</span><span class="pun">.</span><span class="pln">medium </span><span class="pun">|</span><span class="pln"> </span><span class="lit">4096</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> m1</span><span class="pun">.</span><span class="pln">large </span><span class="pun">|</span><span class="pln"> </span><span class="lit">8192</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">80</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> m1</span><span class="pun">.</span><span class="pln">xlarge </span><span class="pun">|</span><span class="pln"> </span><span class="lit">16384</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">160</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><span class="pln">
</span><span class="pun">查看镜像</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova image</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Status</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Server</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2707a30b</span><span class="pun">-</span><span class="lit">853f</span><span class="pun">-</span><span class="lit">4d04</span><span class="pun">-</span><span class="lit">861d</span><span class="pun">-</span><span class="pln">e05b0f1855c8 </span><span class="pun">|</span><span class="pln"> cirros </span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+--------+--------+--------+</span><span class="pln">
</span><span class="pun">查看网络</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> neutron net</span><span class="pun">-</span><span class="pln">list
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> id </span><span class="pun">|</span><span class="pln"> name </span><span class="pun">|</span><span class="pln"> subnets </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">1d9657f6</span><span class="pun">-</span><span class="pln">de9e</span><span class="pun">-</span><span class="lit">488f</span><span class="pun">-</span><span class="lit">911f</span><span class="pun">-</span><span class="lit">020c8622fe78</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat </span><span class="pun">|</span><span class="pln"> c53da14a</span><span class="pun">-</span><span class="lit">01fe</span><span class="pun">-</span><span class="lit">4f6c</span><span class="pun">-</span><span class="lit">8485</span><span class="pun">-</span><span class="lit">232489deaa6e</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.0</span><span class="pun">/</span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+------+-----------------------------------------------------+</span><span class="pln">
</span><span class="pun">创建虚拟机</span><span class="pln"> </span><span class="pun">【这一步容易报错，一般都是由于上面的</span><span class="pln"> nova</span><span class="pun">.</span><span class="pln">conf </span><span class="pun">配置填写有误所致】</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova boot </span><span class="pun">--</span><span class="pln">flavor m1</span><span class="pun">.</span><span class="pln">tiny </span><span class="pun">--</span><span class="pln">image cirros </span><span class="pun">--</span><span class="pln">nic net</span><span class="pun">-</span><span class="pln">id</span><span class="pun">=</span><span class="lit">1d9657f6</span><span class="pun">-</span><span class="pln">de9e</span><span class="pun">-</span><span class="lit">488f</span><span class="pun">-</span><span class="lit">911f</span><span class="pun">-</span><span class="lit">020c8622fe78</span><span class="pln"> </span><span class="pun">--</span><span class="pln">security</span><span class="pun">-</span><span class="kwd">group</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">--</span><span class="pln">key</span><span class="pun">-</span><span class="pln">name mykey hello</span><span class="pun">-</span><span class="pln">instance</span></code></pre>
<p><strong>5、查看虚拟机</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova list
</span><span class="pun">+--------------------------------------+---------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Status</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Task</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Power</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Networks</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+---------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">7a6215ac</span><span class="pun">-</span><span class="pln">aea7</span><span class="pun">-</span><span class="lit">4e87</span><span class="pun">-</span><span class="lit">99a3</span><span class="pun">-</span><span class="pln">b62c06d4610e </span><span class="pun">|</span><span class="pln"> hello</span><span class="pun">-</span><span class="pln">instance</span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Running</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+---------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">*************************************************************************</span><span class="pln">
</span><span class="pun">如果要删除虚拟机（利用虚拟机</span><span class="pln">ID</span><span class="pun">进行删除）</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova </span><span class="kwd">delete</span><span class="pln"> </span><span class="lit">7a6215ac</span><span class="pun">-</span><span class="pln">aea7</span><span class="pun">-</span><span class="lit">4e87</span><span class="pun">-</span><span class="lit">99a3</span><span class="pun">-</span><span class="pln">b62c06d4610e
</span><span class="pun">*************************************************************************</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 src</span><span class="pun">]#</span><span class="pln"> nova list
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Status</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Task</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Power</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Networks</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">007db18f</span><span class="pun">-</span><span class="pln">ae3b</span><span class="pun">-</span><span class="lit">463a</span><span class="pun">-</span><span class="pln">b86d</span><span class="pun">-</span><span class="lit">9a8455a21e2d</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> hello</span><span class="pun">-</span><span class="pln">instance </span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Running</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.101</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> ssh cirros@192</span><span class="pun">.</span><span class="lit">168.1</span><span class="pun">.</span><span class="lit">101</span><span class="pln"> </span><span class="pun">登录查看</span></code></pre>
<hr>
<p>上面创建虚拟机的时候，openstack在neutron组网内是采用dhcp-agent自动分配ip的！</p>
<p>可以在创建虚拟机的时候，指定固定ip，方法详见于另一篇博客：</p>
<blockquote class="wp-embedded-content" data-secret="DFgb2t6pzM" style="display: none;"><p><a href="https://www.tracymc.cn/archives/2008">OpenStack为虚拟机指定固定ip</a></p></blockquote>
<p><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/embed(1).html" data-secret="DFgb2t6pzM" width="500" height="200" title="《OpenStack为虚拟机指定固定ip》—Tracymc的技术博客" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<hr>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">6</span><span class="pun">、</span><span class="pln"> web </span><span class="pun">界面打开虚拟机</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> nova </span><span class="kwd">get</span><span class="pun">-</span><span class="pln">vnc</span><span class="pun">-</span><span class="pln">console hello</span><span class="pun">-</span><span class="pln">instance novnc
</span><span class="pun">+-------+-----------------------------------------------------------------------------------</span><span class="pln">
</span><span class="pun">-+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Url</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
</span><span class="pun">-------+-----------------------------------------------------------------------------------</span><span class="pln">
</span><span class="pun">-+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> novnc </span><span class="pun">|</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//58.68.250.17:6080/vnc_auto.html?token=303d5a78-c85f-4ed9-93b6-be9d5d28fba6 |       #访问这个链接即可打开vnc界面</span><span class="pln">
</span><span class="pun">+-------+-----------------------------------------------------------------------------------</span><span class="pln">
</span><span class="pun">-+</span></code></pre>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364023194719.jpg" alt="">￼</p>
<h3>4.0 安装 dashboard，登陆 web 管理界面</h3>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> yum install openstack</span><span class="pun">-</span><span class="pln">dashboard </span><span class="pun">-</span><span class="pln">y
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">openstack</span><span class="pun">-</span><span class="pln">dashboard</span><span class="pun">/</span><span class="pln">local_settings               </span><span class="com">#按照下面几行进行配置修改</span><span class="pln">
OPENSTACK_HOST </span><span class="pun">=</span><span class="pln"> </span><span class="str">"192.168.1.17"</span><span class="pln">                                 </span><span class="com">#更改为keystone机器地址</span><span class="pln">
OPENSTACK_KEYSTONE_DEFAULT_ROLE </span><span class="pun">=</span><span class="pln"> </span><span class="str">"user"</span><span class="pln">              </span><span class="com">#默认的角色</span><span class="pln">
ALLOWED_HOSTS </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'*'</span><span class="pun">]</span><span class="pln">                                                 </span><span class="com">#允许所有主机访问</span><span class="pln">
CACHES </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="str">'default'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="str">'BACKEND'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'django.core.cache.backends.memcached.MemcachedCache'</span><span class="pun">,</span><span class="pln">
</span><span class="str">'LOCATION'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'192.168.1.17:11211'</span><span class="pun">,</span><span class="pln">                                   </span><span class="com">#连接memcached</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="com">#CACHES = {</span><span class="pln">
</span><span class="com"># 'default': {</span><span class="pln">
</span><span class="com"># 'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',</span><span class="pln">
</span><span class="com"># }</span><span class="pln">
</span><span class="com">#}</span><span class="pln">
TIME_ZONE </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Asia/Shanghai"</span><span class="pln">                        </span><span class="com">#设置时区</span><span class="pln">
</span><span class="pun">重启</span><span class="pln"> httpd </span><span class="pun">服务</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@linux</span><span class="pun">-</span><span class="pln">node1 </span><span class="pun">~]#</span><span class="pln"> systemctl restart httpd</span></code></pre>
<p>web 界面登录访问dashboard<br>
http://58.68.250.17/dashboard/<br>
用户密码 demo 或者 admin（管理员）<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364023506686.jpg" alt="">￼</p>
<hr>
<p><strong>如果要修改dashboard的访问端口（比如将80端口改为8080端口），则需要修改下面两个配置文件：</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1</span><span class="pun">）</span><span class="pln">vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">/</span><span class="pln">conf</span><span class="pun">/</span><span class="pln">httpd</span><span class="pun">.</span><span class="pln">conf
</span><span class="pun">将</span><span class="lit">80</span><span class="pun">端口修改为</span><span class="lit">8080</span><span class="pun">端口</span><span class="pln">
</span><span class="typ">Listen</span><span class="pln"> </span><span class="lit">8080</span><span class="pln">
</span><span class="typ">ServerName</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.17</span><span class="pun">:</span><span class="lit">8080</span><span class="pln">
</span><span class="lit">2</span><span class="pun">）</span><span class="pln">vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">openstack</span><span class="pun">-</span><span class="pln">dashboard</span><span class="pun">/</span><span class="pln">local_settings </span><span class="com">#将下面两处的端口由80改为8080</span><span class="pln">
</span><span class="str">'from_port'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'8080'</span><span class="pun">,</span><span class="pln">
</span><span class="str">'to_port'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'8080'</span><span class="pun">,</span><span class="pln">
</span><span class="pun">然后重启</span><span class="pln">http</span><span class="pun">服务：</span><span class="pln">
systemctl restart httpd</span></code></pre>
<p>如果开启了防火墙，还需要开通8080端口访问规则</p>
<p>这样，dashboard访问url：</p>
<h2>http://58.68.250.17:8080/dashboard</h2>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364023861001.jpg" alt="">￼</p>
<p>前面建立了两个账号：admin 和 demo，两个账号都可以登陆web！只不过， admin 是管理员账号， admin 登陆后可以看到其他账号下的状态<br>
demo 等普通账号登陆后只能看到自己的状态<br>
注意：<br>
<strong>上面的 Rabbit 账号 admin 和 openstack 是消息队列的 web 登陆账号。<br>
比如一下子要建立 10 个虚拟机的指令，但是当前资源处理不过来，就通过 Rabbit 进行排队！！</strong></p>
<hr>
<p>修改OpenStack中dashboard用户登陆密码的方法：</p>
<p>登陆dashboard：<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024080505.jpg" alt="">￼</p>
<p><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024167547.jpg" alt="">￼</p>
<hr>
<p>创建虚拟机的时候，我们可以自己定义虚拟机的类型（即配置）。</p>
<p>登陆openstack的web管理界面里进行自定义，也可以将之前的删除。</p>
<p>查看上传到glance的镜像<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024265938.jpg" alt="">￼</p>
<p>查看创建的虚拟机实例<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024306120.jpg" alt="">￼</p>
<p>自定义虚拟主机类型，设置如下：<br>
（如果想让虚拟机有空闲磁盘空间，用于新建分区之用，则可以在这里分配临时磁盘）<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024366094.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024413337.jpg" alt="">￼</p>
<p>我创建了四个虚拟机实例，采用的是同一个虚拟主机类型（即上面的kvm002），四个实例总共占用宿主机40G的空间。<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024548770.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024583175.jpg" alt="">￼</p>
<p>登陆到openstack，可以看到，左侧一共有四个标签栏：<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024643872.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024680576.jpg" alt="">￼<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024712634.jpg" alt="">￼</p>
<hr>
<p>可以登陆dashboard界面，在“计算”-&gt;“实例”里选择“启动云主机"或者“计算-&gt;网络-&gt;网络拓扑”里选择“启动虚拟机”就可以再创建一个虚拟机<br>
也可以按照快照再启动（创建）一个虚拟机，不过这样启动起来的虚拟机是一个新的ip（快照前的源虚拟机就要关机了）</p>
<p>查看实例，发现kvm-server005虚拟机已经创建成功了。默认创建后的ip是dhcp自动分配的，可以登陆虚拟机改成static静态ip<br>
<img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/15364024817601.jpg" alt="">￼</p>
<hr>
<p>在openstack 中重启实例有两种，分别被称为“软重启”和“硬重启”。所谓的软重启会尝试正常关机并重启实例，硬重启会直接将实例“断电”并重启。也就是说硬重启会“关闭”电源。其具体命令如下：</p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">默认情况下，如果您通过</span><span class="pln">nova</span><span class="pun">重启，执行的是软重启。</span><span class="pln">
$ nova reboot SERVER
</span><span class="pun">如果您需要执行硬重启，添加--</span><span class="pln">hard</span><span class="pun">参数即可：</span><span class="pln">
$ nova reboot </span><span class="pun">--</span><span class="pln">hard SERVER</span></code></pre>
<p><strong>nova命令管理虚拟机：</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pln">$ nova list </span><span class="com">#查看虚拟机</span><span class="pln">
$ nova stop </span><span class="pun">[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">name</span><span class="pun">]或[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="com">#关闭虚拟机</span><span class="pln">
$ nova start </span><span class="pun">[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">name</span><span class="pun">]或[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="com">#启动虚拟机</span><span class="pln">
$ nova suspend </span><span class="pun">[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">name</span><span class="pun">]或[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="com">#暂停虚拟机</span><span class="pln">
$ nova resume </span><span class="pun">[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">name</span><span class="pun">]或[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="com">#启动暂停的虚拟机</span><span class="pln">
$ nova </span><span class="kwd">delete</span><span class="pln"> </span><span class="pun">[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">name</span><span class="pun">]或[</span><span class="pln">vm</span><span class="pun">-</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="com">#删除虚拟机</span><span class="pln">
$nova</span><span class="pun">-</span><span class="pln">manage service list    </span><span class="com">#检查服务是否正常</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> source </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">admin</span><span class="pun">-</span><span class="pln">openrc</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> nova list
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> ID </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Status</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Task</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Power</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Networks</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">11e7ad7f</span><span class="pun">-</span><span class="pln">c0a8</span><span class="pun">-</span><span class="lit">482b</span><span class="pun">-</span><span class="pln">abca</span><span class="pun">-</span><span class="lit">3a4b7cfdd55d</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> hello</span><span class="pun">-</span><span class="pln">instance </span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Running</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.107</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="lit">67f71703</span><span class="pun">-</span><span class="pln">c32c</span><span class="pun">-</span><span class="lit">4bf1</span><span class="pun">-</span><span class="lit">8778</span><span class="pun">-</span><span class="pln">b2a6600ad34a </span><span class="pun">|</span><span class="pln"> kvm</span><span class="pun">-</span><span class="pln">server0 </span><span class="pun">|</span><span class="pln"> ACTIVE </span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Running</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> flat</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.120</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------+----------------+--------+------------+-------------+--------------------+</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> ll </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">nova</span><span class="pun">/</span><span class="pln">instances</span><span class="pun">/</span><span class="pln">           </span><span class="com">#下面是虚拟机的存放路径</span><span class="pln">
total </span><span class="lit">8</span><span class="pln">
drwxr</span><span class="pun">-</span><span class="pln">xr</span><span class="pun">-</span><span class="pln">x</span><span class="pun">.</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> nova nova </span><span class="lit">85</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">22</span><span class="pln"> </span><span class="lit">11e7ad7f</span><span class="pun">-</span><span class="pln">c0a8</span><span class="pun">-</span><span class="lit">482b</span><span class="pun">-</span><span class="pln">abca</span><span class="pun">-</span><span class="lit">3a4b7cfdd55d</span><span class="pln">
drwxr</span><span class="pun">-</span><span class="pln">xr</span><span class="pun">-</span><span class="pln">x</span><span class="pun">.</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> nova nova </span><span class="lit">85</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">48</span><span class="pln"> </span><span class="lit">67f71703</span><span class="pun">-</span><span class="pln">c32c</span><span class="pun">-</span><span class="lit">4bf1</span><span class="pun">-</span><span class="lit">8778</span><span class="pun">-</span><span class="pln">b2a6600ad34a
drwxr</span><span class="pun">-</span><span class="pln">xr</span><span class="pun">-</span><span class="pln">x</span><span class="pun">.</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> nova nova </span><span class="lit">80</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">40</span><span class="pln"> _base
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln">r</span><span class="pun">--.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> nova nova </span><span class="lit">39</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">16</span><span class="pun">:</span><span class="lit">44</span><span class="pln"> compute_nodes
drwxr</span><span class="pun">-</span><span class="pln">xr</span><span class="pun">-</span><span class="pln">x</span><span class="pun">.</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> nova nova </span><span class="lit">4096</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">58</span><span class="pln"> locks</span></code></pre>
<hr>
<p><strong>virsh命令行管理虚拟机：</strong></p>
<pre class="prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh list </span><span class="com">#查看虚拟机</span><span class="pln">
</span><span class="typ">Id</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="typ">State</span><span class="pln">
</span><span class="pun">----------------------------------------------------</span><span class="pln">
</span><span class="lit">9</span><span class="pln"> instance</span><span class="pun">-</span><span class="lit">00000008</span><span class="pln"> running
</span><span class="lit">41</span><span class="pln"> instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> running
</span><span class="pun">[</span><span class="pln">root@openstack</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> ll </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">libvirt</span><span class="pun">/</span><span class="pln">qemu</span><span class="pun">/</span><span class="pln"> </span><span class="com">#虚拟机文件</span><span class="pln">
total </span><span class="lit">16</span><span class="pln">
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-------.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> root root </span><span class="lit">4457</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">26</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">46</span><span class="pln"> instance</span><span class="pun">-</span><span class="lit">00000008.xml</span><span class="pln">
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-------.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> root root </span><span class="lit">4599</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">40</span><span class="pln"> instance</span><span class="pun">-</span><span class="lit">00000015.xml</span><span class="pln">
drwx</span><span class="pun">------.</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> root root </span><span class="lit">22</span><span class="pln"> </span><span class="typ">Aug</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="lit">12</span><span class="pun">:</span><span class="lit">06</span><span class="pln"> networks
</span><span class="pun">其中：</span><span class="pln">
virsh list </span><span class="com">#显示本地活动虚拟机</span><span class="pln">
virsh list </span><span class="pun">--</span><span class="pln">all </span><span class="com">#显示本地所有的虚拟机（活动的+不活动的）</span><span class="pln">
virsh define instance</span><span class="pun">-</span><span class="lit">00000015.xml</span><span class="pln"> </span><span class="com">#通过配置文件定义一个虚拟机（这个虚拟机还不是活动的）</span><span class="pln">
virsh edit instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com"># 编辑配置文件（一般是在刚定义完虚拟机之后）</span><span class="pln">
virsh start instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#启动名字为ubuntu的非活动虚拟机</span><span class="pln">
virsh reboot instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#重启虚拟机</span><span class="pln">
virsh create instance</span><span class="pun">-</span><span class="lit">00000015.xml</span><span class="pln"> </span><span class="com">#创建虚拟机（创建后，虚拟机立即执行，成为活动主机）</span><span class="pln">
virsh suspend instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#暂停虚拟机</span><span class="pln">
virsh resume instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#启动暂停的虚拟机</span><span class="pln">
virsh shutdown instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#正常关闭虚拟机</span><span class="pln">
virsh destroy instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#强制关闭虚拟机</span><span class="pln">
virsh dominfo instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#显示虚拟机的基本信息</span><span class="pln">
virsh domname </span><span class="lit">2</span><span class="pln"> </span><span class="com">#显示id号为2的虚拟机名</span><span class="pln">
virsh domid instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#显示虚拟机id号</span><span class="pln">
virsh domuuid instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#显示虚拟机的uuid</span><span class="pln">
virsh domstate instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#显示虚拟机的当前状态</span><span class="pln">
virsh dumpxml instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="com">#显示虚拟机的当前配置文件（可能和定义虚拟机时的配置不同，因为当虚拟机启动时，需要给虚拟机分配id号、uuid、vnc端口号等等）</span><span class="pln">
virsh setmem instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="lit">512000</span><span class="pln"> </span><span class="com">#给不活动虚拟机设置内存大小</span><span class="pln">
virsh setvcpus instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="com"># 给不活动虚拟机设置cpu个数</span><span class="pln">
virsh save instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> a  </span><span class="com">#将该instance-00000015虚拟机的运行状态存储到文件a中</span><span class="pln">
virsh restore a    </span><span class="com">#恢复被存储状态的虚拟机的状态，即便虚拟机被删除也可以恢复（如果虚拟机已经被undefine移除，那么恢复的虚拟机也只是一个临时的状态，关闭后自动消失）</span><span class="pln">
virsh undefine instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln">    </span><span class="com">#移除虚拟机，虚拟机处于关闭状态后还可以启动，但是被该指令删除后不能启动。在虚拟机处于Running状态时，调用该指令，该指令暂时不生效，但是当虚拟机被关闭后，该指令生效移除该虚拟机，也可以在该指令生效之前调用define+TestKVM.xml取消该指令</span><span class="pln">
</span><span class="pun">注意：</span><span class="pln">
virsh destroy instance</span><span class="pun">-</span><span class="lit">00000015</span><span class="pln"> </span><span class="pun">这条命令并不是真正的删除这个虚拟机，只是将这个虚拟机强制关闭了。可以通过该虚拟机的</span><span class="pln">xml</span><span class="pun">文件恢复。如下：</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh list
</span><span class="typ">Id</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="typ">State</span><span class="pln">
</span><span class="pun">----------------------------------------------------</span><span class="pln">
</span><span class="lit">1</span><span class="pln"> dev</span><span class="pun">-</span><span class="kwd">new</span><span class="pun">-</span><span class="pln">test2 running
</span><span class="lit">2</span><span class="pln"> beta</span><span class="pun">-</span><span class="pln">new2 running
</span><span class="lit">5</span><span class="pln"> test</span><span class="pun">-</span><span class="pln">server running
</span><span class="lit">8</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test03 running
</span><span class="lit">9</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node1 running
</span><span class="lit">10</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node2 running
</span><span class="lit">11</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test01 running
</span><span class="lit">12</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test02 running
</span><span class="pun">强制关闭虚拟机</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh destroy ubuntu</span><span class="pun">-</span><span class="pln">test02
</span><span class="typ">Domain</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test02 destroyed
</span><span class="pun">发现</span><span class="pln">ubuntu</span><span class="pun">-</span><span class="pln">test02</span><span class="pun">虚拟机已经关闭了</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh list
</span><span class="typ">Id</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="typ">State</span><span class="pln">
</span><span class="pun">----------------------------------------------------</span><span class="pln">
</span><span class="lit">1</span><span class="pln"> dev</span><span class="pun">-</span><span class="kwd">new</span><span class="pun">-</span><span class="pln">test2 running
</span><span class="lit">2</span><span class="pln"> beta</span><span class="pun">-</span><span class="pln">new2 running
</span><span class="lit">5</span><span class="pln"> test</span><span class="pun">-</span><span class="pln">server running
</span><span class="lit">8</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test03 running
</span><span class="lit">9</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node1 running
</span><span class="lit">10</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node2 running
</span><span class="lit">11</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test01 running
</span><span class="pun">但是该虚拟机的</span><span class="pln">xml</span><span class="pun">文件还在，可以通过这个文件恢复</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> ll </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">libvirt</span><span class="pun">/</span><span class="pln">qemu</span><span class="pun">/</span><span class="pln">ubuntu</span><span class="pun">-</span><span class="pln">test02</span><span class="pun">.</span><span class="pln">xml
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-------</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> root root </span><span class="lit">2600</span><span class="pln"> </span><span class="typ">Dec</span><span class="pln"> </span><span class="lit">26</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">55</span><span class="pln"> </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">libvirt</span><span class="pun">/</span><span class="pln">qemu</span><span class="pun">/</span><span class="pln">ubuntu</span><span class="pun">-</span><span class="pln">test02</span><span class="pun">.</span><span class="pln">xml
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh define </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">libvirt</span><span class="pun">/</span><span class="pln">qemu</span><span class="pun">/</span><span class="pln">ubuntu</span><span class="pun">-</span><span class="pln">test02</span><span class="pun">.</span><span class="pln">xml </span><span class="com">#这只是重新添加了这个虚拟机，目前还不是活动的虚拟机，需要启动下</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh start ubuntu</span><span class="pun">-</span><span class="pln">test02
</span><span class="typ">Domain</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test02 started
</span><span class="pun">[</span><span class="pln">root@kvm</span><span class="pun">-</span><span class="pln">server </span><span class="pun">~]#</span><span class="pln"> virsh list
</span><span class="typ">Id</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="typ">State</span><span class="pln">
</span><span class="pun">----------------------------------------------------</span><span class="pln">
</span><span class="lit">1</span><span class="pln"> dev</span><span class="pun">-</span><span class="kwd">new</span><span class="pun">-</span><span class="pln">test2 running
</span><span class="lit">2</span><span class="pln"> beta</span><span class="pun">-</span><span class="pln">new2 running
</span><span class="lit">5</span><span class="pln"> test</span><span class="pun">-</span><span class="pln">server running
</span><span class="lit">8</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test03 running
</span><span class="lit">9</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node1 running
</span><span class="lit">10</span><span class="pln"> elk</span><span class="pun">-</span><span class="pln">node2 running
</span><span class="lit">11</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test01 running
</span><span class="lit">12</span><span class="pln"> ubuntu</span><span class="pun">-</span><span class="pln">test02 running</span></code></pre>
</div>
<div class="post-meta">
<p class="post-categories"><span>Read more posts about</span> <a href="https://www.tracymc.cn/archives/category/%e4%b8%bb%e6%9c%ba" title="View all posts in 主机">主机</a></p>			<div class="post-tags"><ul><li><a href="https://www.tracymc.cn/archives/tag/openstack" title="View all posts tagged openstack">openstack</a></li></ul></div>			<nav class="further-reading">
<div class="previous">
<span>Previous Post</span>
<a href="https://www.tracymc.cn/archives/2001" rel="prev">Docker集群管理工具-Kubernetes部署记录</a>	</div>
<div class="next">
<span>Next Post</span>
<a href="https://www.tracymc.cn/archives/2005" rel="next">用OZ工具制作openstack镜像</a>	</div>
</nav>		</div>
</article>
<section id="comments" class="comments">
<div class="comments-number">
<h2>
Be First to Comment            </h2>
</div>
<ol class="comment-list">
</ol>
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://www.tracymc.cn/archives/2049#respond" style="display:none;">取消回复</a></small></h3><form action="https://www.tracymc.cn/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate=""><p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment">
<label for="comment">Comment</label>
<textarea required="" id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea>
</p><p class="comment-form-author">
<label for="author">Name*</label>
<input id="author" name="author" type="text" placeholder="Jane Doe" value="" size="30" aria-required="true">
</p>
<p class="comment-form-email">
<label for="email">Email*</label>
<input id="email" name="email" type="email" placeholder="name@email.com" value="" size="30" aria-required="true">
</p>
<p class="comment-form-url">
<label for="url">Website</label>
<input id="url" name="url" type="url" placeholder="http://google.com" value="" size="30">
</p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论"> <input type="hidden" name="comment_post_ID" value="2049" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="f68b8b3e5c"></p><p style="display: none;"></p><input type="hidden" id="ak_js" name="ak_js" value="1589623680485"></form>	</div><!-- #respond -->
</section>
</div>    </div>
</section> <!-- .main -->
<footer id="site-footer" class="site-footer" role="contentinfo"><p></p>
<p style="font-size:11px;);">Copyright © 2018-2019 by <a href="https://www.tracymc.cn/">McGrady的技术分享.</a> All Rights Reserved.
</p>
<a href="http://www.beian.miit.gov.cn/" rel="external nofollow" style="font-size:11px" target="_blank">
苏ICP备18014869号-1 
</a><a style="font-size:11px;">|</a>

<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32011302320571" style="display:inline-block;text-decoration:none;height:11px;line-height:11px;"><img src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/-1-e1522395593924.png" style="float:left;"><p style="float:left;height:11px;line-height:11px;font-size:11px;margin: 0px 0px 0px 5px;">苏公网安备 32011302320571号</p></a>
</footer>
<script type="text/javascript">
/* <![CDATA[ */
var ct_cele_objectL10n = {"openMenu":"open menu","closeMenu":"close menu","openChildMenu":"open dropdown menu","closeChildMenu":"close dropdown menu"};
/* ]]> */
</script>
<script type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/production.min.js.下载"></script>
<script type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/comment-reply.min.js.下载"></script>
<script type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/prettify.min.js.下载"></script>
<script type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/wp-embed.min.js.下载"></script>
<script type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/markdown.min.js.下载"></script>
<script async="async" type="text/javascript" src="./完整部署CentOS7.2+OpenStack+kvm 云平台环境 – McGrady的技术分享_files/form.js.下载"></script>
<script>
var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?ad35a037eb08d6ef18639cb8345386be";
var s = document.getElementsByTagName("script")[0]; 
s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else {
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script>

</div></div></body></html>